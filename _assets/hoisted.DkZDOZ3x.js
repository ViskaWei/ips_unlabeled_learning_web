import{k as se}from"./katex.C2VIrnuv.js";import{S as ae,P as re,W as ce,B as Ot,C as Rt,a as gt,b as de,A as jt,c as he,L as fe,d as ge}from"./three.PuYaAVZH.js";const pt=document.getElementById("lcurve-viz"),Et=document.getElementById("lambda-slider"),It=document.getElementById("noise-slider"),Ct=document.getElementById("cond-slider"),Ht=document.getElementById("lambda-value"),Yt=document.getElementById("noise-value"),Jt=document.getElementById("cond-value");if(pt){let k=function(){return m=(m*16807+0)%2147483647,m/2147483647},n=function(){const t=k(),x=k();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*x)},o=function(){m=42,V=Array.from({length:a},()=>n())},i=function(){return Array.from({length:a},(t,x)=>Math.pow(10,1-$*x/(a-1)))},r=function(t){return t.map((x,h)=>x*g[h]+w*V[h])},l=function(){const t=i(),x=r(t);return R.map((h,c)=>{let P=0,v=0;const T=[];for(let b=0;b<a;b++){const _=t[b]/(t[b]*t[b]+h)*x[b];T.push(_),P+=_*_;const L=h*x[b]/(t[b]*t[b]+h);v+=L*L}const F=Math.sqrt(Math.max(P,1e-30)),B=Math.sqrt(Math.max(v,1e-30));return{lambda:h,logLambda:I[c],solNorm:F,resNorm:B,logSol:Math.log10(F),logRes:Math.log10(B),solution:T}})},p=function(t){const x=t.length,h=new Array(x).fill(0);for(let c=1;c<x-1;c++){const P=t[c+1].logLambda-t[c-1].logLambda,v=(t[c+1].logRes-t[c-1].logRes)/P,T=(t[c+1].logSol-t[c-1].logSol)/P,F=P/2,B=(t[c+1].logRes-2*t[c].logRes+t[c-1].logRes)/(F*F),b=(t[c+1].logSol-2*t[c].logSol+t[c-1].logSol)/(F*F),C=Math.pow(v*v+T*T,1.5);h[c]=C>1e-20?(v*b-T*B)/C:0}return h},y=function(t){let x=-1/0,h=0;for(let c=2;c<t.length-2;c++)t[c]>x&&(x=t[c],h=c);return h},A=function(){const t=pt.getBoundingClientRect(),x=window.devicePixelRatio;e.width=t.width*x,e.height=t.height*x,e.getContext("2d").setTransform(x,0,0,x,0,0)},d=function(t,x,h){return t+(x-t)*h},f=function(){const t=e.getContext("2d"),x=e.width/window.devicePixelRatio,h=e.height/window.devicePixelRatio;t.clearRect(0,0,x,h);const c=l(),P=p(c),v=y(P),T=Math.round((E-u)/(M-u)*(s-1)),F=Math.max(0,Math.min(s-1,T)),B=20,b=55,C=15,_=30,L=85,O=x-b-C,j=b+O*.55,W=h-_-L,N=j-b-B/2,D=W,K=c.map(S=>S.logSol),dt=c.map(S=>S.logRes),lt=Math.min(...K)-.1,Z=Math.max(...K)+.1,G=Math.min(...dt)-.1,H=Math.max(...dt)+.1;function U(S){return b+(S-lt)/(Z-lt)*N}function X(S){return _+D-(S-G)/(H-G)*D}t.strokeStyle="rgba(255, 255, 255, 0.05)",t.lineWidth=1;for(let S=Math.ceil(lt);S<=Math.floor(Z);S++){const q=U(S);t.beginPath(),t.moveTo(q,_),t.lineTo(q,_+D),t.stroke()}for(let S=Math.ceil(G);S<=Math.floor(H);S++){const q=X(S);t.beginPath(),t.moveTo(b,q),t.lineTo(b+N,q),t.stroke()}t.beginPath();for(let S=0;S<c.length;S++){const q=U(c[S].logSol),z=X(c[S].logRes);S===0?t.moveTo(q,z):t.lineTo(q,z)}t.strokeStyle="#3b82f6",t.lineWidth=2.5,t.stroke();for(let S=0;S<c.length;S+=10){const q=U(c[S].logSol),z=X(c[S].logRes),et=S/(c.length-1);t.beginPath(),t.arc(q,z,2.5,0,Math.PI*2),t.fillStyle=`rgba(${Math.round(d(59,239,et))}, ${Math.round(d(130,68,et))}, ${Math.round(d(246,68,et))}, 0.6)`,t.fill()}{const S=U(c[v].logSol),q=X(c[v].logRes);t.beginPath(),t.arc(S,q,14,0,Math.PI*2),t.fillStyle="rgba(34, 197, 94, 0.2)",t.fill(),t.beginPath(),t.arc(S,q,8,0,Math.PI*2),t.fillStyle="#22c55e",t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke(),t.fillStyle="#22c55e",t.font="bold 11px JetBrains Mono, monospace",t.textAlign="left",t.fillText(`λ* = ${c[v].lambda.toExponential(1)}`,S+14,q+4)}{const S=c[F],q=U(S.logSol),z=X(S.logRes);t.beginPath(),t.arc(q,z,10,0,Math.PI*2),t.fillStyle="rgba(245, 158, 11, 0.3)",t.fill(),t.beginPath(),t.arc(q,z,6,0,Math.PI*2),t.fillStyle="#f59e0b",t.fill(),t.strokeStyle="#d97706",t.lineWidth=2,t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.textAlign="center",t.fillText("log ‖xλ‖ (solution norm)",b+N/2,_+D+18),t.save(),t.translate(12,_+D/2),t.rotate(-Math.PI/2),t.fillText("log ‖Axλ−b‖ (residual)",0,0),t.restore(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="bold 13px Inter, sans-serif",t.textAlign="center",t.fillText("L-curve",b+N/2,_-10);const tt=_+D-15;t.font="10px Inter, sans-serif",t.fillStyle="rgba(239, 68, 68, 0.6)",t.textAlign="left",t.fillText("← over-regularized",b+5,tt),t.textAlign="right",t.fillText("under-regularized →",b+N-5,_+20);const Y=j+B/2,J=x-C-Y,st=W*.45,$t=P.slice(2,-2),oe=Math.max(...$t,.1),St=Math.min(...$t,0);function ut(S){return Y+(S-u)/(M-u)*J}function bt(S){return _+st-(S-St)/(oe-St+1e-10)*st}t.strokeStyle="rgba(255, 255, 255, 0.05)",t.lineWidth=1;for(let S=Math.ceil(u);S<=Math.floor(M);S+=2){const q=ut(S);t.beginPath(),t.moveTo(q,_),t.lineTo(q,_+st),t.stroke()}if(St<0){const S=bt(0);t.strokeStyle="rgba(255, 255, 255, 0.1)",t.setLineDash([4,4]),t.beginPath(),t.moveTo(Y,S),t.lineTo(Y+J,S),t.stroke(),t.setLineDash([])}t.beginPath();for(let S=2;S<P.length-2;S++){const q=ut(I[S]),z=bt(P[S]);S===2?t.moveTo(q,z):t.lineTo(q,z)}t.strokeStyle="#8b5cf6",t.lineWidth=2,t.stroke();{const S=ut(I[v]),q=bt(P[v]);t.beginPath(),t.arc(S,q,6,0,Math.PI*2),t.fillStyle="#22c55e",t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke()}if(F>=2&&F<P.length-2){const S=ut(I[F]),q=bt(P[F]);t.beginPath(),t.arc(S,q,5,0,Math.PI*2),t.fillStyle="#f59e0b",t.fill()}t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="bold 13px Inter, sans-serif",t.textAlign="center",t.fillText("Curvature κ(λ)",Y+J/2,_-10),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.fillText("log λ",Y+J/2,_+st+18);const ht=_+st+35,at=W-st-35,Mt=J/a,ft=6,vt=c[F].solution,ie=[...g,...vt],qt=Math.max(...ie.map(Math.abs),.01)*1.2;t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.textAlign="center",t.fillText("Recovered vs True Solution",Y+J/2,ht-5);for(let S=0;S<a;S++){const q=Y+S*Mt,z=(Mt-ft*2)/2,et=g[S]/qt*at*.8,Nt=ht+at*.9-Math.max(et,0);t.fillStyle="rgba(6, 182, 212, 0.4)",t.fillRect(q+ft,Nt,z,Math.abs(et)),t.strokeStyle="#06b6d4",t.lineWidth=1,t.strokeRect(q+ft,Nt,z,Math.abs(et));const At=vt[S]/qt*at*.8,Dt=ht+at*.9-Math.max(At,0);t.fillStyle="rgba(245, 158, 11, 0.4)",t.fillRect(q+ft+z,Dt,z,Math.abs(At)),t.strokeStyle="#f59e0b",t.lineWidth=1,t.strokeRect(q+ft+z,Dt,z,Math.abs(At)),t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="10px JetBrains Mono, monospace",t.textAlign="center",t.fillText(`x${S+1}`,q+Mt/2,ht+at-2)}const Wt=ht+at+12;t.font="10px Inter, sans-serif",t.fillStyle="#06b6d4",t.textAlign="right",t.fillText("■ True",Y+J/2-5,Wt),t.fillStyle="#f59e0b",t.textAlign="left",t.fillText("■ Recovered",Y+J/2+5,Wt);const rt=_+D+30;t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px JetBrains Mono, monospace",t.textAlign="left";const _t=c[F],le=c[v],zt=i(),Tt=Math.sqrt(vt.reduce((S,q,z)=>S+(q-g[z])**2,0)/g.reduce((S,q)=>S+q*q,0))*100;t.fillText(`λ = ${_t.lambda.toExponential(2)}`,b,rt),t.fillText(`‖xλ‖ = ${_t.solNorm.toFixed(3)}`,b,rt+16),t.fillText(`‖rλ‖ = ${_t.resNorm.toFixed(3)}`,b,rt+32),t.fillStyle=Tt<10?"#22c55e":Tt<30?"#f59e0b":"#ef4444",t.fillText(`err = ${Tt.toFixed(1)}%`,b+180,rt),t.fillStyle="#22c55e",t.fillText(`λ* = ${le.lambda.toExponential(2)}`,b+180,rt+16),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText(`κ = ${zt[0].toFixed(1)} / ${zt[a-1].toExponential(1)}`,b+180,rt+32),requestAnimationFrame(f)};const e=document.createElement("canvas");e.style.width="100%",e.style.height="100%",pt.style.position="relative",pt.replaceChildren(e);const a=5,g=[1,.8,.5,.3,.1];let m=42;const s=200,u=-8,M=4,I=Array.from({length:s},(t,x)=>u+(M-u)*x/(s-1)),R=I.map(t=>Math.pow(10,t));let w=.5,$=4,E=-2,V=[];o(),Et&&Et.addEventListener("input",()=>{if(E=parseFloat(Et.value),Ht){const t=Math.pow(10,E);Ht.textContent=t<.001?t.toExponential(1):t.toFixed(4)}}),It&&It.addEventListener("input",()=>{w=parseFloat(It.value),Yt&&(Yt.textContent=w.toFixed(2))}),Ct&&Ct.addEventListener("input",()=>{$=parseFloat(Ct.value),Jt&&(Jt.textContent=`10^${$.toFixed(1)}`)}),A(),window.addEventListener("resize",A),f()}const xt=document.getElementById("dt-slider-viz"),kt=document.getElementById("dt-slider"),Xt=document.getElementById("dt-value");if(xt&&kt){let k=function(e){return{nn_V:p.nn_selftest_V[e],nn_Phi:p.nn_selftest_Phi[e],oracle_V:p.oracle_selftest_V[e],oracle_Phi:p.oracle_selftest_Phi[e],mle_V:p.oracle_mle_V[e],mle_Phi:p.oracle_mle_Phi[e]}},n=function(){const e=xt.getBoundingClientRect(),a=window.devicePixelRatio;y.width=e.width*a,y.height=e.height*a,y.getContext("2d").setTransform(a,0,0,a,0,0)},o=function(e,a,g){return e+(a-e)*g},i=function(e){return e<=5?`rgb(${Math.round(o(34,200,e/5))}, ${Math.round(o(197,180,e/5))}, ${Math.round(o(94,20,e/5))})`:e<=30?`rgb(${Math.round(o(200,239,(e-5)/25))}, ${Math.round(o(180,100,(e-5)/25))}, ${Math.round(o(20,20,(e-5)/25))})`:`rgb(239, ${Math.round(o(100,50,Math.min((e-30)/70,1)))}, ${Math.round(o(20,50,Math.min((e-30)/70,1)))})`},r=function(){const e=y.getContext("2d"),a=y.width/window.devicePixelRatio,g=y.height/window.devicePixelRatio;e.clearRect(0,0,a,g);const m=k(A);for(const[x,h]of Object.entries(m))x in d||(d[x]=h),d[x]+=(h-d[x])*.12;const s=150,u=40,M=10,I=44,R=18,w=a-s-u,$=100,E=[{title:"∇V Error",rows:[{method:f[0],val:d.nn_V,target:m.nn_V},{method:f[1],val:d.oracle_V,target:m.oracle_V},{method:f[2],val:d.mle_V,target:m.mle_V}]},{title:"∇Φ Error",rows:[{method:f[0],val:d.nn_Phi,target:m.nn_Phi},{method:f[1],val:d.oracle_Phi,target:m.oracle_Phi},{method:f[2],val:d.mle_Phi,target:m.mle_Phi}]}];let V=M;for(const x of E){e.fillStyle="rgba(255, 255, 255, 0.5)",e.font="bold 12px Inter, sans-serif",e.textAlign="left",e.fillText(x.title,s,V+14),V+=22;for(const h of x.rows){const c=V+(I-R)/2;e.fillStyle=h.method.label,e.font="12px Inter, sans-serif",e.textAlign="right",e.fillText(h.method.name,s-12,c+R/2+4);const P=e.createLinearGradient(s,0,s+w,0);P.addColorStop(0,"rgba(34, 197, 94, 0.15)"),P.addColorStop(.1,"rgba(34, 197, 94, 0.12)"),P.addColorStop(.3,"rgba(245, 158, 11, 0.12)"),P.addColorStop(.6,"rgba(239, 68, 68, 0.12)"),P.addColorStop(1,"rgba(239, 68, 68, 0.2)"),e.fillStyle=P,e.beginPath(),e.roundRect(s,c,w,R,4),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.06)",e.lineWidth=1,e.stroke();const v=5/$*w;e.fillStyle="rgba(34, 197, 94, 0.08)",e.beginPath(),e.roundRect(s,c,v,R,[4,0,0,4]),e.fill();const T=Math.min(h.val/$,1),F=T*w,B=i(h.val);e.fillStyle=B,e.globalAlpha=.35,e.beginPath(),e.roundRect(s,c,F,R,4),e.fill(),e.globalAlpha=1;const b=s+T*w,C=c+R/2,_=8;e.beginPath(),e.arc(b,C,_+4,0,Math.PI*2),e.fillStyle=`${h.method.dot}33`,e.fill(),e.beginPath(),e.arc(b,C,_,0,Math.PI*2),e.fillStyle=h.method.dot,e.fill(),e.beginPath(),e.arc(b,C,_,0,Math.PI*2),e.strokeStyle=h.method.ring,e.lineWidth=2,e.stroke();const L=`${h.target.toFixed(1)}%`,O=b+_+8;e.fillStyle=h.val>30?"#ef4444":h.val>10?"#f59e0b":"#22c55e",e.font="bold 11px JetBrains Mono, monospace",e.textAlign="left",T>.85?(e.textAlign="right",e.fillText(L,b-_-6,C+4)):e.fillText(L,O,C+4),V+=I}V+=8}const t=V+2;e.fillStyle="#22c55e",e.font="10px Inter, sans-serif",e.textAlign="left",e.fillText("Good (0%)",s,t),e.fillStyle="#ef4444",e.textAlign="right",e.fillText("Bad (100%)",s+w,t),e.fillStyle="rgba(255, 255, 255, 0.25)",e.textAlign="center",e.fillText("10%",s+w*.1,t),e.fillText("50%",s+w*.5,t),e.fillStyle="rgba(255, 255, 255, 0.35)",e.font="11px Inter, sans-serif",e.textAlign="center",e.fillText(`Model A at Δt = ${l[A]}  (d=2, M=2000, N=10)`,a/2,t+20),requestAnimationFrame(r)};const l=["0.001","0.01","0.1"],p={oracle_mle_V:[6.08,20.3,.49],oracle_mle_Phi:[12.5,52.9,92.2],oracle_selftest_V:[.78,.82,8.03],oracle_selftest_Phi:[1.72,2.69,2.84],nn_selftest_V:[.45,1.95,5.69],nn_selftest_Phi:[3.81,4.03,8.86]},y=document.createElement("canvas");y.style.width="100%",y.style.height="100%",xt.style.position="relative",xt.replaceChildren(y);let A=1,d={};const f=[{key:"nn",name:"NN Self-Test (ours)",dot:"#22c55e",ring:"#16a34a",label:"#22c55e"},{key:"oracle",name:"Oracle Self-Test",dot:"#f59e0b",ring:"#d97706",label:"#f59e0b"},{key:"mle",name:"Oracle MLE",dot:"#94a3b8",ring:"#64748b",label:"#94a3b8"}];kt.addEventListener("input",()=>{A=parseInt(kt.value),Xt&&(Xt.textContent=l[A])}),n(),window.addEventListener("resize",()=>{n()}),r()}const me={"math-selftest":String.raw`\mathcal{L}(\theta) = \frac{1}{2}\, J_{\text{diss}}\, \Delta t \;-\; \frac{\sigma^2}{2}\, J_{\text{diff}}\, \Delta t \;+\; \delta E_{\text{tot}}`,"math-sde":String.raw`dX_t^i = \left(-\nabla V(X_t^i) - \frac{1}{N}\sum_{j \neq i} \nabla\Phi(X_t^i - X_t^j)\right) dt + \sigma\, dW_t^i`,"math-ito":String.raw`\underbrace{\delta E_{\text{tot}}}_{\text{energy change}} \;=\; \underbrace{\frac{\sigma^2}{2}\, J_{\text{diff}}\, \Delta t}_{\text{diffusion (income)}} \;-\; \underbrace{J_{\text{diss}}\, \Delta t}_{\text{dissipation (spending)}} \;+\; \text{martingale}`,"math-loss":String.raw`\mathbb{E}\!\left[\mathcal{L}(V^*, \Phi^*)\right] = -\frac{1}{2}\,\mathbb{E}\!\left[J_{\text{diss}}^*\, \Delta t\right] < 0 \qquad \text{vs.} \qquad \mathcal{L}(0, 0) = 0`};for(const[k,n]of Object.entries(me)){const o=document.getElementById(k);o&&se.render(n,o,{displayMode:!0,throwOnError:!1})}const mt=document.getElementById("results-heatmap"),Gt=document.querySelectorAll("[data-table]");if(mt){let k=function(e){return e<=5?`rgba(34, 197, 94, ${.3+.7*(1-e/5)})`:e<=20?`rgba(245, 158, 11, ${.3+.4*((e-5)/15)})`:e<=50?`rgba(239, 68, 68, ${.3+.3*((e-20)/30)})`:"rgba(239, 68, 68, 0.8)"},n=function(e,a,g){const m=document.createElement(e);return a&&Object.assign(m.style,a),g&&(m.textContent=g),m},o=function(e){const a=e.data;!a||a.length===0||(mt.replaceChildren(),d==="cross_method"?y(a):A(a))},i=function(){const e=document.createElement("table");return Object.assign(e.style,{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"}),e},r=function(e,a){const g=document.createElement("tr");g.style.borderBottom="2px solid rgba(255,255,255,0.1)";for(const m of a){const s=document.createElement("th");s.textContent=m.text,s.style.padding="8px",s.style.textAlign=m.colspan?"center":"left",s.style.color=m.color||"var(--text-muted)",m.colspan&&(s.colSpan=m.colspan),g.appendChild(s)}e.appendChild(g)},l=function(e,a){const g=document.createElement("tr");g.style.borderBottom="1px solid rgba(255,255,255,0.06)";for(const m of a){const s=document.createElement("th");s.textContent=m,s.style.padding="4px 8px",s.style.fontSize="0.75rem",s.style.color="var(--text-muted)",g.appendChild(s)}e.appendChild(g)},p=function(e,a,g){const m=document.createElement("td");m.textContent=a>=100?a.toFixed(0):a.toFixed(1),m.title=`${a}%`,Object.assign(m.style,{padding:"6px 8px",textAlign:"center",background:k(a),fontWeight:g?"700":"normal"}),e.appendChild(m)},y=function(e){const a=i(),g=document.createElement("thead");r(g,[{text:"Model"},{text:"d"},{text:"Oracle Best",colspan:2,color:"#22c55e"},{text:"RBF Best",colspan:2,color:"#f59e0b"},{text:"NN Best (ours)",colspan:2,color:"#3b82f6"}]),l(g,["","","∇V","∇Φ","∇V","∇Φ","∇V","∇Φ"]),a.appendChild(g);const m=document.createElement("tbody");for(const s of e){const u=document.createElement("tr");u.style.borderBottom="1px solid rgba(255,255,255,0.04)";const M=n("td",{padding:"6px 8px",fontWeight:"600"},s.model);u.appendChild(M);const I=n("td",{padding:"6px 8px",textAlign:"center",color:"var(--text-muted)"},String(s.d));u.appendChild(I);const R=Math.min(s.oracle_V,s.rbf_V,s.nn_V),w=Math.min(s.oracle_Phi,s.rbf_Phi,s.nn_Phi);p(u,s.oracle_V,s.oracle_V===R),p(u,s.oracle_Phi,s.oracle_Phi===w),p(u,s.rbf_V,s.rbf_V===R),p(u,s.rbf_Phi,s.rbf_Phi===w),p(u,s.nn_V,s.nn_V===R),p(u,s.nn_Phi,s.nn_Phi===w),m.appendChild(u)}a.appendChild(m),mt.replaceChildren(a)},A=function(e){const a=i(),g=document.createElement("thead");r(g,[{text:"Model"},{text:"Δt"},{text:"Oracle MLE",colspan:2,color:"#22c55e"},{text:"Oracle Self-Test",colspan:2,color:"#f59e0b"},{text:"NN Self-Test",colspan:2,color:"#3b82f6"}]),l(g,["","","∇V","∇Φ","∇V","∇Φ","∇V","∇Φ"]),a.appendChild(g);const m=document.createElement("tbody");for(const s of e){const u=document.createElement("tr");u.style.borderBottom="1px solid rgba(255,255,255,0.04)";const M=n("td",{padding:"6px 8px",fontWeight:"600"},s.model);u.appendChild(M);const I=n("td",{padding:"6px 8px",textAlign:"center",fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--text-muted)"},String(s.dt_obs));u.appendChild(I);const R=Math.min(s.oracle_mle_V,s.oracle_selftest_V,s.nn_selftest_V),w=Math.min(s.oracle_mle_Phi,s.oracle_selftest_Phi,s.nn_selftest_Phi);p(u,s.oracle_mle_V,s.oracle_mle_V===R),p(u,s.oracle_mle_Phi,s.oracle_mle_Phi===w),p(u,s.oracle_selftest_V,s.oracle_selftest_V===R),p(u,s.oracle_selftest_Phi,s.oracle_selftest_Phi===w),p(u,s.nn_selftest_V,s.nn_selftest_V===R),p(u,s.nn_selftest_Phi,s.nn_selftest_Phi===w),m.appendChild(u)}a.appendChild(m),mt.replaceChildren(a)},d="cross_method";Gt.forEach(e=>{e.addEventListener("click",()=>{Gt.forEach(a=>a.classList.remove("active")),e.classList.add("active"),d=e.dataset.table||"cross_method",f()})});async function f(){const e="/ips_unlabeled_learning_web";try{const g=await(await fetch(`${e}/data/${d}.json`)).json();o(g)}catch{mt.textContent="Loading results data..."}}f()}class ee{s;constructor(n){this.s=new Uint32Array(4);for(let o=0;o<4;o++){n+=2654435769;let i=n^n>>>16;i=Math.imul(i,569420461),i^=i>>>15,i=Math.imul(i,1935289751),i^=i>>>15,this.s[o]=i>>>0}}next(){const n=this.s,o=Math.imul(n[1]*5,7)>>>0,i=n[1]<<9;return n[2]^=n[0],n[3]^=n[1],n[1]^=n[2],n[0]^=n[3],n[2]^=i,n[3]=n[3]<<11|n[3]>>>21,(o>>>0)/4294967296}random(){return this.next()}randn(){const n=this.next(),o=this.next();return Math.sqrt(-2*Math.log(n+1e-30))*Math.cos(2*Math.PI*o)}randnArray(n){for(let o=0;o<n.length;o++)n[o]=this.randn()}}class Bt{constructor(n,o,i,r,l,p,y=42){this.V=n,this.Phi=o,this.sigma=i,this.dt=r,this.N=l,this.d=p,this.prng=new ee(y),this.gradV=new Float64Array(p),this.gradPhi=new Float64Array(p),this.diff=new Float64Array(p),this.noise=new Float64Array(l*p),this.gradOut=new Float64Array(p)}gradV;gradPhi;diff;noise;gradOut;prng;initialize(n=1){const o=new Float64Array(this.N*this.d);for(let i=0;i<o.length;i++)o[i]=n*this.prng.randn();return{positions:o,N:this.N,d:this.d}}getParticle(n,o){return n.positions.subarray(o*this.d,(o+1)*this.d)}step(n){const{N:o,d:i,dt:r,sigma:l}=this,p=Math.sqrt(r);this.prng.randnArray(this.noise);for(let y=0;y<o;y++){const A=this.getParticle(n,y);this.V.gradient(A,this.gradV);for(let f=0;f<i;f++)this.gradPhi[f]=0;if(this.Phi.radial)for(let f=0;f<o;f++){if(y===f)continue;const e=this.getParticle(n,f);let a=0;for(let s=0;s<i;s++)this.diff[s]=A[s]-e[s],a+=this.diff[s]*this.diff[s];const g=Math.max(Math.sqrt(a),1e-10),m=this.Phi.gradient(g);for(let s=0;s<i;s++)this.gradPhi[s]+=m*this.diff[s]/g}else for(let f=0;f<o;f++){if(y===f)continue;const e=this.getParticle(n,f);for(let a=0;a<i;a++)this.diff[a]=A[a]-e[a];this.Phi.gradient(this.diff,this.gradOut);for(let a=0;a<i;a++)this.gradPhi[a]+=this.gradOut[a]}for(let f=0;f<i;f++)this.gradPhi[f]/=o;const d=y*i;for(let f=0;f<i;f++)A[f]+=(-this.gradV[f]-this.gradPhi[f])*r+l*p*this.noise[d+f]}}simulate(n,o=1){const i=this.initialize(o),r=[{positions:new Float64Array(i.positions),N:this.N,d:this.d}];for(let l=0;l<n;l++)this.step(i),(l%10===0||l===n-1)&&r.push({positions:new Float64Array(i.positions),N:this.N,d:this.d});return r}}class ue{constructor(n=1){this.k=n}evaluate(n){let o=0;for(let i=0;i<n.length;i++)o+=n[i]*n[i];return .5*this.k*o}gradient(n,o){for(let i=0;i<n.length;i++)o[i]=this.k*n[i]}}class be{constructor(n=-1,o=2){this.alpha1=n,this.alpha2=o}evaluate(n){let o=0;for(let r=0;r<n.length;r++)o+=n[r]*n[r];const i=Math.sqrt(o);return .5*this.alpha1*i+this.alpha2*o}gradient(n,o){let i=0;for(let y=0;y<n.length;y++)i+=n[y]*n[y];const r=Math.max(Math.sqrt(i),1e-10),l=.5*this.alpha1/r,p=2*this.alpha2;for(let y=0;y<n.length;y++)o[y]=l*n[y]+p*n[y]}}class Pt{evaluate(n){let o=0;for(let i=0;i<n.length;i++)o+=n[i]*n[i];return .25*(o-1)**2}gradient(n,o){let i=0;for(let l=0;l<n.length;l++)i+=n[l]*n[l];const r=i-1;for(let l=0;l<n.length;l++)o[l]=r*n[l]}}class pe{constructor(n){this.a=n}evaluate(n){let o=0;for(let i=0;i<n.length;i++)o+=this.a[i]*n[i]*n[i];return o}gradient(n,o){for(let i=0;i<n.length;i++)o[i]=2*this.a[i]*n[i]}}class xe{constructor(n=-3,o=2,i=.05){this.beta1=n,this.beta2=o,this.eps=i}radial=!0;smoothInd(n,o,i){return .5*(Math.tanh((n-o)/this.eps)-Math.tanh((n-i)/this.eps))}smoothIndGrad(n,o,i){const r=1/Math.cosh((n-o)/this.eps)**2,l=1/Math.cosh((n-i)/this.eps)**2;return .5/this.eps*(r-l)}evaluate(n){return this.beta1*this.smoothInd(n,.5,1)+this.beta2*this.smoothInd(n,1,2)}gradient(n){return this.beta1*this.smoothIndGrad(n,.5,1)+this.beta2*this.smoothIndGrad(n,1,2)}}class Ft{constructor(n=.5){this.gamma=n}radial=!0;evaluate(n){return this.gamma/(n+1)}gradient(n){return-this.gamma/((n+1)*(n+1))}}class ye{constructor(n=.5,o=2,i=.8){this.D=n,this.a=o,this.r0=i}radial=!0;evaluate(n){const o=Math.exp(-this.a*(n-this.r0));return this.D*(1-o)**2}gradient(n){const o=Math.exp(-this.a*(n-this.r0));return 2*this.D*this.a*(1-o)*o}}class we{constructor(n=.5,o=.5,i=2.5,r=.7){this.epsilon=n,this.sigmaLJ=o,this.rCut=i,this.rSafe=r*o;const l=(o/i)**6;this.shift=4*n*(l**2-l)}radial=!0;rSafe;shift;evaluate(n){if(n>=this.rCut)return 0;const o=Math.max(n,this.rSafe),i=(this.sigmaLJ/o)**6;return 4*this.epsilon*(i*i-i)-this.shift}gradient(n){if(n>=this.rCut)return 0;const o=Math.max(n,this.rSafe),i=(this.sigmaLJ/o)**6;return 4*this.epsilon/o*(-12*i*i+6*i)}}class Pe{constructor(n=2,o=[.5,1.5]){this.A=n,this.s=o,this.sSq=o.map(i=>i*i)}radial=!1;sSq;evaluate(n){let o=0;for(let i=0;i<n.length;i++)o+=n[i]*n[i]/this.sSq[i];return this.A*Math.exp(-.5*o)}gradient(n,o){const i=this.evaluate(n);for(let r=0;r<n.length;r++)o[r]=-i*n[r]/this.sSq[r]}}const Lt={model_a:{name:"model_a",label:"Model A (Quadratic + Piecewise)",V:new be(-1,2),Phi:new xe(-3,2),sigma:.1,description:"Quadratic confinement with piecewise constant interaction"},model_b:{name:"model_b",label:"Model B (Double-Well + Inverse)",V:new Pt,Phi:new Ft(.5),sigma:.1,description:"Double-well confinement with inverse-distance interaction"},model_lj:{name:"model_lj",label:"Model C (Harmonic + Lennard-Jones)",V:new ue(2),Phi:new we,sigma:.1,description:"Harmonic confinement with truncated Lennard-Jones interaction"},model_morse:{name:"model_morse",label:"Model D (Double-Well + Morse)",V:new Pt,Phi:new ye(.5,2,.8),sigma:.1,description:"Double-well confinement with Morse interaction"},model_aniso:{name:"model_aniso",label:"Model E (Anisotropic)",V:new pe([1,4]),Phi:new Pe(2,[.5,1.5]),sigma:.1,description:"Anisotropic confinement with direction-dependent Gaussian interaction"}},yt=document.getElementById("potential-curves-canvas"),wt=document.getElementById("model-sim-canvas"),Ut=document.querySelectorAll(".model-tabs .toggle-btn");if(yt&&wt){let k=function(d){const f=Lt[d];f&&(p=d,y=new Bt(f.V,f.Phi,f.sigma,.005,10,2,42),A=y.initialize(.8))},n=function(){const d=Lt[p];if(!d)return;const f=yt.width,e=yt.height;r.clearRect(0,0,f,e);const a=45,g=15,m=25,s=35,u=f-a-g,M=(e-m-s-20)/2;o(r,a,m,u,M,"V(x)","#3b82f6",R=>{const w=new Float64Array([R,0]);return d.V.evaluate(w)},-2.5,2.5,-1,5);const I=m+M+20;d.Phi.radial?o(r,a,I,u,M,"Φ(r)","#8b5cf6",R=>d.Phi.evaluate(Math.abs(R)),0,3,-4,3):o(r,a,I,u,M,"Φ(z₁,0)","#8b5cf6",R=>{const w=new Float64Array([R,0]);return d.Phi.evaluate(w)},-3,3,-.5,2.5)},o=function(d,f,e,a,g,m,s,u,M,I,R,w){if(d.fillStyle="rgba(0, 0, 0, 0.2)",d.fillRect(f,e,a,g),d.strokeStyle="rgba(255, 255, 255, 0.15)",d.lineWidth=1,d.beginPath(),d.moveTo(f,e+g),d.lineTo(f+a,e+g),d.stroke(),R<0&&w>0){const E=e+g- -R/(w-R)*g;d.strokeStyle="rgba(255, 255, 255, 0.08)",d.setLineDash([3,3]),d.beginPath(),d.moveTo(f,E),d.lineTo(f+a,E),d.stroke(),d.setLineDash([])}d.beginPath(),d.strokeStyle=s,d.lineWidth=2;const $=200;for(let E=0;E<=$;E++){const V=E/$,t=M+V*(I-M);let x=u(t);x=Math.max(R,Math.min(w,x));const h=f+V*a,c=e+g-(x-R)/(w-R)*g;E===0?d.moveTo(h,c):d.lineTo(h,c)}d.stroke(),d.fillStyle=s,d.font="bold 11px Inter, sans-serif",d.textAlign="left",d.fillText(m,f+5,e+15),d.fillStyle="rgba(255, 255, 255, 0.3)",d.font="9px var(--font-mono), monospace",d.textAlign="left",d.fillText(`${M}`,f,e+g+12),d.textAlign="right",d.fillText(`${I}`,f+a,e+g+12)},i=function(){if(!y||!A)return;const d=wt.width,f=wt.height;l.clearRect(0,0,d,f);for(let u=0;u<3;u++)y.step(A);const e=A.positions,a=Math.min(d,f)*.12,g=d/2,m=f/2;for(let u=0;u<10;u++)for(let M=u+1;M<10;M++){const I=e[u*2]-e[M*2],R=e[u*2+1]-e[M*2+1],w=Math.sqrt(I*I+R*R);if(w<2){const $=g+e[u*2]*a,E=m-e[u*2+1]*a,V=g+e[M*2]*a,t=m-e[M*2+1]*a;l.beginPath(),l.moveTo($,E),l.lineTo(V,t),l.strokeStyle=`rgba(139, 92, 246, ${.2*(1-w/2)})`,l.lineWidth=1,l.stroke()}}for(let u=0;u<10;u++){const M=g+e[u*2]*a,I=m-e[u*2+1]*a;l.beginPath(),l.arc(M,I,7,0,Math.PI*2),l.fillStyle="#06b6d4",l.globalAlpha=.8,l.fill(),l.globalAlpha=1}const s=Lt[p];l.fillStyle="rgba(255, 255, 255, 0.4)",l.font="11px Inter, sans-serif",l.textAlign="left",l.fillText(s?.description||"",10,f-10),requestAnimationFrame(i)};const r=yt.getContext("2d"),l=wt.getContext("2d");let p="model_a",y,A;Ut.forEach(d=>{d.addEventListener("click",()=>{Ut.forEach(e=>e.classList.remove("active")),d.classList.add("active");const f=d.dataset.model||"model_a";k(f),n()})}),k("model_a"),n(),i()}const nt=document.getElementById("loss-landscape-canvas");if(nt){let k=function(){const i=nt.parentElement.getBoundingClientRect();nt.width=i.width*window.devicePixelRatio,nt.height=i.height*window.devicePixelRatio,o.scale(window.devicePixelRatio,window.devicePixelRatio),n()},n=function(){const i=nt.width/window.devicePixelRatio,r=nt.height/window.devicePixelRatio;o.clearRect(0,0,i,r);const l=60,p=30,y=40,A=50,d=(i-l-p-40)/2,f=r-y-A,e=[{x:l,label:"|Residual|² (degenerate)",color:"#ef4444",fn:"squared"},{x:l+d+40,label:"Self-Test Loss (ours)",color:"#3b82f6",fn:"selftest"}],a=2,g=1;for(const m of e){const{x:s,label:u,color:M,fn:I}=m;o.strokeStyle="rgba(255, 255, 255, 0.15)",o.lineWidth=1,o.beginPath(),o.moveTo(s,y),o.lineTo(s,y+f),o.lineTo(s+d,y+f),o.stroke();const R=y+f*.4;o.strokeStyle="rgba(255, 255, 255, 0.08)",o.setLineDash([4,4]),o.beginPath(),o.moveTo(s,R),o.lineTo(s+d,R),o.stroke(),o.setLineDash([]),o.fillStyle="rgba(255, 255, 255, 0.4)",o.font="10px Inter, sans-serif",o.textAlign="right",o.fillText("0",s-5,R+4),o.textAlign="center",o.fillText(u,s+d/2,y-10),o.fillText("0",s,y+f+18),o.fillText("scale s",s+d/2,y+f+35),o.fillText("1 (true)",s+d*.5,y+f+18),o.fillText("2",s+d,y+f+18),o.beginPath(),o.strokeStyle=M,o.lineWidth=2.5;const w=200;for(let E=0;E<=w;E++){const V=E/w*2,t=s+E/w*d;let x;if(I==="squared"){const v=.5*V*V*a-V*g*.5;x=v*v}else x=.5*V*V*a-V*a;const h=I==="squared"?.5:1.5,c=R-x*(f*.3)*h,P=Math.max(y,Math.min(y+f,c));E===0?o.moveTo(t,P):o.lineTo(t,P)}o.stroke();const $=(E,V,t)=>{const x=s+E/2*d;let h;if(I==="squared"){const v=.5*E*E*a-E*g*.5;h=v*v}else h=.5*E*E*a-E*a;const c=I==="squared"?.5:1.5,P=Math.max(y,Math.min(y+f,R-h*(f*.3)*c));o.beginPath(),o.arc(x,P,5,0,Math.PI*2),o.fillStyle=t,o.fill(),o.fillStyle=t,o.font="bold 10px Inter, sans-serif",o.textAlign="center",o.fillText(V,x,P-12)};$(0,"s=0","#f59e0b"),$(1,"s=1 (true)","#22c55e"),I==="squared"?(o.fillStyle="#ef4444",o.font="11px Inter, sans-serif",o.textAlign="center",o.fillText("Both are minima!",s+d/2,y+f-10)):(o.fillStyle="#22c55e",o.font="11px Inter, sans-serif",o.textAlign="center",o.fillText("Only true minimum is negative",s+d/2,y+f-10))}};const o=nt.getContext("2d");k(),window.addEventListener("resize",k)}const ot=document.getElementById("energy-canvas"),Qt=document.getElementById("v-scale"),Kt=document.getElementById("phi-scale");if(ot&&Qt&&Kt){let k=function(w,$,E){let V=0,t=0;const x=new Float64Array(p);for(let h=0;h<l;h++){for(let c=0;c<p;c++)x[c]=w[h*p+c];V+=d.evaluate(x)*$;for(let c=h+1;c<l;c++){let P=0;for(let v=0;v<p;v++){const T=w[h*p+v]-w[c*p+v];P+=T*T}t+=f.evaluate(Math.sqrt(P))*E}}return V/l+t/(l*l)},n=function(w,$,E){let V=0;const t=new Float64Array(p),x=new Float64Array(p),h=new Float64Array(p);for(let c=0;c<l;c++){for(let B=0;B<p;B++)h[B]=w[c*p+B];d.gradient(h,t);for(let B=0;B<p;B++)t[B]*=$;let P=0,v=0;for(let B=0;B<l;B++){if(c===B)continue;let b=0;for(let L=0;L<p;L++)x[L]=w[c*p+L]-w[B*p+L],b+=x[L]*x[L];const C=Math.max(Math.sqrt(b),1e-10),_=f.gradient(C)*E;P+=_*x[0]/C,v+=_*x[1]/C}P/=l,v/=l;const T=t[0]+P,F=t[1]+v;V+=T*T+F*F}return V/l},o=function(){const w=ot.parentElement.getBoundingClientRect();ot.width=w.width*window.devicePixelRatio,ot.height=w.height*window.devicePixelRatio,r.scale(window.devicePixelRatio,window.devicePixelRatio)},i=function(){const w=ot.width/window.devicePixelRatio,$=ot.height/window.devicePixelRatio;r.clearRect(0,0,w,$);const E=parseFloat(Qt.value),V=parseFloat(Kt.value);for(let H=0;H<3;H++)e.step(a);const t=k(R,E,V),h=k(a.positions,E,V)-t,c=n(R,E,V)*A;g=u*g+(1-u)*(.5*c),m=u*m+(1-u)*h;const P=g+m;s=u*s+(1-u)*P,I.push(s),I.length>M&&I.shift(),R.set(a.positions);const v=w*.4,T=v+30,F=Math.min(v,$)/5.5,B=v/2,b=$/2;r.beginPath(),r.arc(B,b,F,0,Math.PI*2),r.strokeStyle="rgba(255, 255, 255, 0.04)",r.lineWidth=1,r.stroke();for(let H=0;H<l;H++){const U=B+a.positions[H*2]*F,X=b-a.positions[H*2+1]*F;r.beginPath(),r.arc(U,X,14,0,Math.PI*2),r.fillStyle="rgba(59, 130, 246, 0.08)",r.fill(),r.beginPath(),r.arc(U,X,8,0,Math.PI*2),r.fillStyle="#3b82f6",r.globalAlpha=.7,r.fill(),r.globalAlpha=1}const C=w-T-20,_=22,L=30;r.fillStyle="rgba(255, 255, 255, 0.6)",r.font="bold 13px Inter, sans-serif",r.textAlign="left",r.fillText("Energy Ledger",T,L);const O=C*.7,j=Math.min(Math.abs(g)*2e3,O),W=L+25;r.fillStyle="rgba(239, 68, 68, 0.15)",r.fillRect(T,W,C,_),r.fillStyle="rgba(239, 68, 68, 0.6)",r.fillRect(T,W,j,_),r.fillStyle="#ef4444",r.font="11px Inter, sans-serif",r.fillText(`Dissipation (spending): ${g.toFixed(5)}`,T+5,W+15);const N=W+_+8,D=Math.min(Math.abs(m)*2e3,O);r.fillStyle="rgba(59, 130, 246, 0.15)",r.fillRect(T,N,C,_),r.fillStyle=m<0?"rgba(34, 197, 94, 0.6)":"rgba(59, 130, 246, 0.6)",r.fillRect(T,N,D,_),r.fillStyle="#3b82f6",r.fillText(`Energy change (balance): ${m.toFixed(5)}`,T+5,N+15);const K=N+_+15,dt=Math.abs(s)<.001?"#22c55e":"#ef4444";r.fillStyle=dt,r.font="bold 13px Inter, sans-serif",r.fillText(`Self-test loss: ${s.toFixed(5)}`,T,K+5),r.fillStyle="rgba(255, 255, 255, 0.4)",r.font="11px Inter, sans-serif",r.fillText(`V scale: ${E.toFixed(1)}×  |  Φ scale: ${V.toFixed(1)}×`,T,K+25);const lt=Math.abs(E-1)<.05&&Math.abs(V-1)<.05;r.fillStyle=lt?"#22c55e":"#f59e0b",r.fillText(lt?"✓ True potentials — loss is negative":"✗ Wrong potentials — residual grows",T,K+45);const Z=K+65,G=$-Z-20;if(G>40&&I.length>2){r.strokeStyle="rgba(255, 255, 255, 0.1)",r.lineWidth=1,r.beginPath(),r.moveTo(T,Z+G/2),r.lineTo(T+C,Z+G/2),r.stroke();const H=Math.min(...I,-.01),X=Math.max(...I,.01)-H||.01;r.beginPath(),r.strokeStyle=dt,r.lineWidth=1.5;for(let tt=0;tt<I.length;tt++){const Y=T+tt/M*C,J=Z+G-(I[tt]-H)/X*G;tt===0?r.moveTo(Y,J):r.lineTo(Y,J)}r.stroke()}requestAnimationFrame(i)};const r=ot.getContext("2d"),l=10,p=2,y=.15,A=.008,d=new Pt,f=new Ft(.5),e=new Bt(d,f,y,A,l,p,77),a=e.initialize(1);for(let w=0;w<300;w++)e.step(a);let g=0,m=0,s=0;const u=.95,M=200,I=[];let R=new Float64Array(a.positions);o(),window.addEventListener("resize",o),i()}const it=document.getElementById("shuffle-demo-canvas"),Zt=document.getElementById("shuffle-btn");if(it&&Zt){let k=function(){const a=it.parentElement.getBoundingClientRect();it.width=a.width*window.devicePixelRatio,it.height=a.height*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio)},n=function(a,g,m,s,u){return[m+a*u,s-g*u]},o=function(){const a=it.width/window.devicePixelRatio,g=it.height/window.devicePixelRatio,m=a/2,s=Math.min(m,g)*.35;i.clearRect(0,0,a,g),e<1&&(e=Math.min(1,e+.03)),i.fillStyle="rgba(255, 255, 255, 0.03)",i.fillRect(0,0,m-1,g),i.fillStyle="rgba(255, 255, 255, 0.5)",i.font="13px Inter, sans-serif",i.textAlign="center",i.fillText("Snapshot t₁",m/2,25),i.fillStyle="rgba(255, 255, 255, 0.03)",i.fillRect(m+1,0,m,g),i.fillStyle="rgba(255, 255, 255, 0.5)",i.fillText("Snapshot t₂",m+m/2,25);for(let M=0;M<r;M++){const[I,R]=n(y[M][0],y[M][1],m/2,g/2,s),w=d[M],[$,E]=n(A[w][0],A[w][1],m+m/2,g/2,s),V=M,[t,x]=n(A[V][0],A[V][1],m+m/2,g/2,s),h=t+($-t)*e,c=x+(E-x)*e,P=w===M;i.beginPath(),i.moveTo(I,R),i.lineTo(h,c),i.strokeStyle=P||!f?"rgba(34, 197, 94, 0.4)":"rgba(239, 68, 68, 0.4)",i.lineWidth=1.5,i.setLineDash([4,4]),i.stroke(),i.setLineDash([])}const u=14;for(let M=0;M<r;M++){const[I,R]=n(y[M][0],y[M][1],m/2,g/2,s);i.beginPath(),i.arc(I,R,u,0,Math.PI*2),i.fillStyle=p[M],i.fill(),i.fillStyle="white",i.font="bold 10px Inter, sans-serif",i.textAlign="center",i.textBaseline="middle",i.fillText(`${M+1}`,I,R),d[M];const[w,$]=n(A[M][0],A[M][1],m+m/2,g/2,s);i.beginPath(),i.arc(w,$,u,0,Math.PI*2),i.fillStyle=f?"#475569":p[M],i.fill(),f?(i.fillStyle="rgba(255,255,255,0.5)",i.fillText("?",w,$)):(i.fillStyle="white",i.fillText(`${M+1}`,w,$))}if(f&&e>=1){const M=d.filter((I,R)=>I===R).length;i.fillStyle="rgba(255, 255, 255, 0.6)",i.font="12px Inter, sans-serif",i.textAlign="center",i.fillText(`Random matching: ${M}/${r} correct`,a/2,g-15)}requestAnimationFrame(o)};const i=it.getContext("2d"),r=8,l=new ee(123),p=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#f97316"],y=[],A=[];for(let a=0;a<r;a++){const g=-.8+l.random()*1.6,m=-.7+l.random()*1.4;y.push([g,m]),A.push([g+(l.random()-.5)*.6,m+(l.random()-.5)*.6])}let d=Array.from({length:r},(a,g)=>g),f=!1,e=1;Zt.addEventListener("click",()=>{if(!(e<1)){if(f)d=Array.from({length:r},(a,g)=>g),f=!1;else{d=Array.from({length:r},(a,g)=>g);for(let a=r-1;a>0;a--){const g=Math.floor(Math.random()*(a+1));[d[a],d[g]]=[d[g],d[a]]}f=!0}e=0}}),k(),window.addEventListener("resize",k),o()}const Q=document.getElementById("label-demo-canvas");if(Q){let k=function(){const h=Q.parentElement.getBoundingClientRect();Q.width=h.width*window.devicePixelRatio,Q.height=h.height*window.devicePixelRatio,l.scale(window.devicePixelRatio,window.devicePixelRatio)},n=function(h,c,P,v){const T=Math.min(P,v)/5.5;return[P/2+h*T,v/2-c*T]},o=function(h,c){for(let b=0;b<5;b++)f.step(e);g.push(new Float64Array(e.positions)),g.length>a&&g.shift();const P=e.positions,[v,T]=n(0,0,h,c),F=Math.min(h,c)/5.5;if(l.beginPath(),l.arc(v,T,F,0,Math.PI*2),l.strokeStyle="rgba(255, 255, 255, 0.04)",l.lineWidth=1,l.stroke(),g.length>2)for(let b=0;b<p;b++){l.beginPath();for(let C=0;C<g.length;C++){const[_,L]=n(g[C][b*2],g[C][b*2+1],h,c);C===0?l.moveTo(_,L):l.lineTo(_,L)}l.strokeStyle=m[b]+"55",l.lineWidth=2.5,l.stroke()}for(let b=0;b<p;b++)for(let C=b+1;C<p;C++){const _=P[b*2]-P[C*2],L=P[b*2+1]-P[C*2+1],O=Math.sqrt(_*_+L*L);if(O<1.2){const[j,W]=n(P[b*2],P[b*2+1],h,c),[N,D]=n(P[C*2],P[C*2+1],h,c);l.beginPath(),l.moveTo(j,W),l.lineTo(N,D),l.strokeStyle=`rgba(255, 255, 255, ${.12*(1-O/1.2)})`,l.lineWidth=1,l.stroke()}}const B=13;for(let b=0;b<p;b++){const[C,_]=n(P[b*2],P[b*2+1],h,c),L=m[b];l.beginPath(),l.arc(C,_,B+6,0,Math.PI*2),l.fillStyle=`${L}22`,l.fill(),l.beginPath(),l.arc(C,_,B,0,Math.PI*2),l.fillStyle=L,l.fill(),l.fillStyle="white",l.font="bold 11px Inter, sans-serif",l.textAlign="center",l.textBaseline="middle",l.fillText(`${b+1}`,C,_)}},i=function(h,c,P){for(let W=0;W<5;W++)f.step(e);const v=P-w;if(v>=M){$=new Float64Array(E);for(let W=0;W<I;W++)f.step(e);E=new Float64Array(e.positions),w=P,V++,t=1}t>0&&(t=Math.max(0,1-(P-w)/R));const[T,F]=n(0,0,h,c),B=Math.min(h,c)/5.5;l.beginPath(),l.arc(T,F,B,0,Math.PI*2),l.strokeStyle="rgba(255, 255, 255, 0.04)",l.lineWidth=1,l.stroke();const b=10;if($)for(let W=0;W<p;W++){const[N,D]=n($[W*2],$[W*2+1],h,c);l.beginPath(),l.arc(N,D,b,0,Math.PI*2),l.strokeStyle="rgba(148, 163, 184, 0.4)",l.lineWidth=2,l.stroke(),l.beginPath(),l.arc(N,D,b,0,Math.PI*2),l.fillStyle="rgba(148, 163, 184, 0.08)",l.fill()}for(let W=0;W<p;W++){const[N,D]=n(E[W*2],E[W*2+1],h,c);l.beginPath(),l.arc(N,D,b+6,0,Math.PI*2),l.fillStyle="rgba(59, 130, 246, 0.10)",l.fill(),l.beginPath(),l.arc(N,D,b,0,Math.PI*2),l.fillStyle=s,l.globalAlpha=.7,l.fill(),l.globalAlpha=1}t>0&&(l.fillStyle=`rgba(255, 255, 255, ${t*.15})`,l.fillRect(0,0,h,c)),l.fillStyle="rgba(148, 163, 184, 0.7)",l.font="12px Inter, sans-serif",l.textAlign="center",l.textBaseline="top",$?l.fillText(`Snapshot ${V} → ${V+1}  —  which dot moved where?`,h/2,c-24):l.fillText("Observing snapshot 1 ...",h/2,c-24);const C=Math.min(v/M,1),_=h*.4,L=3,O=(h-_)/2,j=c-8;l.fillStyle="rgba(148, 163, 184, 0.15)",l.fillRect(O,j,_,L),l.fillStyle="rgba(59, 130, 246, 0.5)",l.fillRect(O,j,_*C,L)},r=function(){const h=Q.width/window.devicePixelRatio,c=Q.height/window.devicePixelRatio,P=performance.now();l.clearRect(0,0,h,c),u?o(h,c):i(h,c,P),requestAnimationFrame(r)};const l=Q.getContext("2d"),p=15,y=2,A=new Pt,d=new Ft(.5),f=new Bt(A,d,.15,.02,p,y,42),e=f.initialize(1);for(let h=0;h<500;h++)f.step(e);const a=60,g=[],m=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#f97316","#14b8a6","#a855f7","#e11d48","#84cc16","#0ea5e9","#d946ef","#fb923c"],s="#3b82f6";let u=!0;const M=2500,I=150,R=300;let w=0,$=null,E=new Float64Array(e.positions),V=0,t=0;const x=Q.closest(".demo-container")?.querySelectorAll(".toggle-btn");x?.forEach(h=>{h.addEventListener("click",()=>{x.forEach(P=>P.classList.remove("active")),h.classList.add("active");const c=u;u=h.dataset.mode==="labeled",!u&&c&&(E=new Float64Array(e.positions),$=null,w=performance.now(),V=0)})}),k(),window.addEventListener("resize",k),w=performance.now(),r()}const te=document.getElementById("hero-canvas");if(te){let k=function(){const t=p.attributes.position.array;for(let v=0;v<l;v++){const T=v*3,F=v*3+1,B=v*3+2;A[T]-=E*t[T],A[F]-=E*t[F],A[B]-=E*t[B];for(let b=0;b<5;b++){const C=Math.floor(Math.random()*l);if(C===v)continue;const _=t[T]-t[C*3],L=t[F]-t[C*3+1],O=t[B]-t[C*3+2],j=Math.sqrt(_*_+L*L+O*O)+.1,W=V*Math.exp(-j*j/4)*2*j/4;A[T]+=W*_/j,A[F]+=W*L/j,A[B]+=W*O/j}A[T]+=(Math.random()-.5)*.005,A[F]+=(Math.random()-.5)*.005,A[B]+=(Math.random()-.5)*.005,A[T]*=.98,A[F]*=.98,A[B]*=.98,t[T]+=A[T],t[F]+=A[F],t[B]+=A[B]}p.attributes.position.needsUpdate=!0;let x=0;const h=u.attributes.position.array,c=u.attributes.color.array,P=3;for(let v=0;v<l&&x<M;v++)for(let T=v+1;T<l&&x<M;T++){const F=t[v*3]-t[T*3],B=t[v*3+1]-t[T*3+1],b=t[v*3+2]-t[T*3+2],C=Math.sqrt(F*F+B*B+b*b);if(C<P){const _=1-C/P,L=x*6;h[L]=t[v*3],h[L+1]=t[v*3+1],h[L+2]=t[v*3+2],h[L+3]=t[T*3],h[L+4]=t[T*3+1],h[L+5]=t[T*3+2],c[L]=.024*_,c[L+1]=.714*_,c[L+2]=.831*_,c[L+3]=.024*_,c[L+4]=.714*_,c[L+5]=.831*_,x++}}u.setDrawRange(0,x*2),u.attributes.position.needsUpdate=!0,u.attributes.color.needsUpdate=!0,s.rotation.y+=.001,$.rotation.y+=.001,i.render(n,o),requestAnimationFrame(k)};const n=new ae,o=new re(60,window.innerWidth/window.innerHeight,.1,100);o.position.z=15;const i=new ce({canvas:te,alpha:!0,antialias:!0});i.setSize(window.innerWidth,window.innerHeight),i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.setClearColor(658967,1);const l=window.innerWidth<768?100:250,p=new Ot,y=new Float32Array(l*3),A=new Float32Array(l*3),d=new Float32Array(l*3),f=new Float32Array(l),e=new Rt(440020),a=new Rt(3900150),g=new Rt(9133302);for(let t=0;t<l;t++){const x=Math.random()*Math.PI*2,h=Math.acos(2*Math.random()-1),c=4+Math.random()*4;y[t*3]=c*Math.sin(h)*Math.cos(x),y[t*3+1]=c*Math.sin(h)*Math.sin(x),y[t*3+2]=c*Math.cos(h),A[t*3]=(Math.random()-.5)*.02,A[t*3+1]=(Math.random()-.5)*.02,A[t*3+2]=(Math.random()-.5)*.02;const P=Math.random(),v=P<.5?e.clone().lerp(a,P*2):a.clone().lerp(g,(P-.5)*2);d[t*3]=v.r,d[t*3+1]=v.g,d[t*3+2]=v.b,f[t]=.08+Math.random()*.12}p.setAttribute("position",new gt(y,3)),p.setAttribute("color",new gt(d,3)),p.setAttribute("size",new gt(f,1));const m=new de({vertexShader:`
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_PointSize = size * (200.0 / -mvPosition.z);
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      varying vec3 vColor;
      void main() {
        float d = length(gl_PointCoord - 0.5);
        if (d > 0.5) discard;
        float alpha = smoothstep(0.5, 0.1, d) * 0.7;
        gl_FragColor = vec4(vColor, alpha);
      }
    `,vertexColors:!0,transparent:!0,depthWrite:!1,blending:jt}),s=new he(p,m);n.add(s);const u=new Ot,M=l*3,I=new Float32Array(M*6),R=new Float32Array(M*6);u.setAttribute("position",new gt(I,3)),u.setAttribute("color",new gt(R,3));const w=new fe({vertexColors:!0,transparent:!0,opacity:.15,blending:jt}),$=new ge(u,w);n.add($);const E=.015,V=.001;k(),window.addEventListener("resize",()=>{o.aspect=window.innerWidth/window.innerHeight,o.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)})}const Vt=document.getElementById("lang-toggle");let ct=localStorage.getItem("ips-lang")||"en";function ne(){Vt&&(Vt.textContent=ct.toUpperCase()),document.documentElement.lang=ct,document.querySelectorAll("[data-i18n-en]").forEach(k=>{const n=ct==="en"?k.getAttribute("data-i18n-en"):k.getAttribute("data-i18n-zh");n&&(k.textContent=n)})}Vt?.addEventListener("click",()=>{ct=ct==="en"?"zh":"en",localStorage.setItem("ips-lang",ct),ne()});ne();const Se=new IntersectionObserver(k=>{k.forEach(n=>{n.isIntersecting&&document.querySelectorAll(".nav-link").forEach(o=>{o.classList.toggle("active",o.getAttribute("href")===`#${n.target.id}`)})})},{rootMargin:"-20% 0px -70% 0px"});document.querySelectorAll("section[id]").forEach(k=>Se.observe(k));document.getElementById("copy-bibtex")?.addEventListener("click",k=>{const n=k.currentTarget,o=n.dataset.bibtex||"";navigator.clipboard.writeText(o).then(()=>{n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy BibTeX"},2e3)})});
