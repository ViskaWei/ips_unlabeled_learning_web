import{k as se}from"./katex.C2VIrnuv.js";import{S as ae,P as re,W as ce,B as jt,C as Et,a as gt,b as de,A as Ot,c as he,L as fe,d as ge}from"./three.PuYaAVZH.js";const pt=document.getElementById("lcurve-viz"),Rt=document.getElementById("lambda-slider"),Ct=document.getElementById("noise-slider"),It=document.getElementById("cond-slider"),Yt=document.getElementById("lambda-value"),Ht=document.getElementById("noise-value"),Jt=document.getElementById("cond-value");if(pt){let C=function(){return f=(f*16807+0)%2147483647,f/2147483647},o=function(){const t=C(),u=C();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*u)},i=function(){f=42,w=Array.from({length:s},()=>o())},e=function(){return Array.from({length:s},(t,u)=>Math.pow(10,1-F*u/(s-1)))},a=function(t){return t.map((u,b)=>u*h[b]+y*w[b])},m=function(){const t=e(),u=a(t);return _.map((b,g)=>{let R=0,M=0;const A=[];for(let k=0;k<s;k++){const I=t[k]/(t[k]*t[k]+b)*u[k];A.push(I),R+=I*I;const q=b*u[k]/(t[k]*t[k]+b);M+=q*q}const L=Math.sqrt(Math.max(R,1e-30)),V=Math.sqrt(Math.max(M,1e-30));return{lambda:b,logLambda:v[g],solNorm:L,resNorm:V,logSol:Math.log10(L),logRes:Math.log10(V),solution:A}})},P=function(t){const u=t.length,b=new Array(u).fill(0);for(let g=1;g<u-1;g++){const R=t[g+1].logLambda-t[g-1].logLambda,M=(t[g+1].logRes-t[g-1].logRes)/R,A=(t[g+1].logSol-t[g-1].logSol)/R,L=R/2,V=(t[g+1].logRes-2*t[g].logRes+t[g-1].logRes)/(L*L),k=(t[g+1].logSol-2*t[g].logSol+t[g-1].logSol)/(L*L),$=Math.pow(M*M+A*A,1.5);b[g]=$>1e-20?(M*k-A*V)/$:0}return b},x=function(t){let u=-1/0,b=0;for(let g=2;g<t.length-2;g++)t[g]>u&&(u=t[g],b=g);return b},T=function(){const t=pt.getBoundingClientRect(),u=window.devicePixelRatio;n.width=t.width*u,n.height=t.height*u,n.getContext("2d").setTransform(u,0,0,u,0,0)},r=function(t,u,b){return t+(u-t)*b},d=function(){const t=n.getContext("2d"),u=n.width/window.devicePixelRatio,b=n.height/window.devicePixelRatio;t.clearRect(0,0,u,b);const g=m(),R=P(g),M=x(R),A=Math.round((E-c)/(p-c)*(l-1)),L=Math.max(0,Math.min(l-1,A)),V=20,k=55,$=15,I=30,q=85,Y=u-k-$,j=k+Y*.55,N=b-I-q,H=j-k-V/2,X=N,K=g.map(S=>S.logSol),dt=g.map(S=>S.logRes),lt=Math.min(...K)-.1,Z=Math.max(...K)+.1,G=Math.min(...dt)-.1,z=Math.max(...dt)+.1;function U(S){return k+(S-lt)/(Z-lt)*H}function J(S){return I+X-(S-G)/(z-G)*X}t.strokeStyle="rgba(255, 255, 255, 0.05)",t.lineWidth=1;for(let S=Math.ceil(lt);S<=Math.floor(Z);S++){const B=U(S);t.beginPath(),t.moveTo(B,I),t.lineTo(B,I+X),t.stroke()}for(let S=Math.ceil(G);S<=Math.floor(z);S++){const B=J(S);t.beginPath(),t.moveTo(k,B),t.lineTo(k+H,B),t.stroke()}t.beginPath();for(let S=0;S<g.length;S++){const B=U(g[S].logSol),W=J(g[S].logRes);S===0?t.moveTo(B,W):t.lineTo(B,W)}t.strokeStyle="#3b82f6",t.lineWidth=2.5,t.stroke();for(let S=0;S<g.length;S+=10){const B=U(g[S].logSol),W=J(g[S].logRes),et=S/(g.length-1);t.beginPath(),t.arc(B,W,2.5,0,Math.PI*2),t.fillStyle=`rgba(${Math.round(r(59,239,et))}, ${Math.round(r(130,68,et))}, ${Math.round(r(246,68,et))}, 0.6)`,t.fill()}{const S=U(g[M].logSol),B=J(g[M].logRes);t.beginPath(),t.arc(S,B,14,0,Math.PI*2),t.fillStyle="rgba(34, 197, 94, 0.2)",t.fill(),t.beginPath(),t.arc(S,B,8,0,Math.PI*2),t.fillStyle="#22c55e",t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke(),t.fillStyle="#22c55e",t.font="bold 11px JetBrains Mono, monospace",t.textAlign="left",t.fillText(`λ* = ${g[M].lambda.toExponential(1)}`,S+14,B+4)}{const S=g[L],B=U(S.logSol),W=J(S.logRes);t.beginPath(),t.arc(B,W,10,0,Math.PI*2),t.fillStyle="rgba(245, 158, 11, 0.3)",t.fill(),t.beginPath(),t.arc(B,W,6,0,Math.PI*2),t.fillStyle="#f59e0b",t.fill(),t.strokeStyle="#d97706",t.lineWidth=2,t.stroke()}t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.textAlign="center",t.fillText("log ‖xλ‖ (solution norm)",k+H/2,I+X+18),t.save(),t.translate(12,I+X/2),t.rotate(-Math.PI/2),t.fillText("log ‖Axλ−b‖ (residual)",0,0),t.restore(),t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="bold 13px Inter, sans-serif",t.textAlign="center",t.fillText("L-curve",k+H/2,I-10);const tt=I+X-15;t.font="10px Inter, sans-serif",t.fillStyle="rgba(239, 68, 68, 0.6)",t.textAlign="left",t.fillText("← over-regularized",k+5,tt),t.textAlign="right",t.fillText("under-regularized →",k+H-5,I+20);const D=j+V/2,O=u-$-D,st=N*.45,Ft=R.slice(2,-2),oe=Math.max(...Ft,.1),St=Math.min(...Ft,0);function ut(S){return D+(S-c)/(p-c)*O}function bt(S){return I+st-(S-St)/(oe-St+1e-10)*st}t.strokeStyle="rgba(255, 255, 255, 0.05)",t.lineWidth=1;for(let S=Math.ceil(c);S<=Math.floor(p);S+=2){const B=ut(S);t.beginPath(),t.moveTo(B,I),t.lineTo(B,I+st),t.stroke()}if(St<0){const S=bt(0);t.strokeStyle="rgba(255, 255, 255, 0.1)",t.setLineDash([4,4]),t.beginPath(),t.moveTo(D,S),t.lineTo(D+O,S),t.stroke(),t.setLineDash([])}t.beginPath();for(let S=2;S<R.length-2;S++){const B=ut(v[S]),W=bt(R[S]);S===2?t.moveTo(B,W):t.lineTo(B,W)}t.strokeStyle="#8b5cf6",t.lineWidth=2,t.stroke();{const S=ut(v[M]),B=bt(R[M]);t.beginPath(),t.arc(S,B,6,0,Math.PI*2),t.fillStyle="#22c55e",t.fill(),t.strokeStyle="#16a34a",t.lineWidth=2,t.stroke()}if(L>=2&&L<R.length-2){const S=ut(v[L]),B=bt(R[L]);t.beginPath(),t.arc(S,B,5,0,Math.PI*2),t.fillStyle="#f59e0b",t.fill()}t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="bold 13px Inter, sans-serif",t.textAlign="center",t.fillText("Curvature κ(λ)",D+O/2,I-10),t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.fillText("log λ",D+O/2,I+st+18);const ht=I+st+35,at=N-st-35,vt=O/s,ft=6,Mt=g[L].solution,ie=[...h,...Mt],$t=Math.max(...ie.map(Math.abs),.01)*1.2;t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px Inter, sans-serif",t.textAlign="center",t.fillText("Recovered vs True Solution",D+O/2,ht-5);for(let S=0;S<s;S++){const B=D+S*vt,W=(vt-ft*2)/2,et=h[S]/$t*at*.8,Dt=ht+at*.9-Math.max(et,0);t.fillStyle="rgba(6, 182, 212, 0.4)",t.fillRect(B+ft,Dt,W,Math.abs(et)),t.strokeStyle="#06b6d4",t.lineWidth=1,t.strokeRect(B+ft,Dt,W,Math.abs(et));const At=Mt[S]/$t*at*.8,Nt=ht+at*.9-Math.max(At,0);t.fillStyle="rgba(245, 158, 11, 0.4)",t.fillRect(B+ft+W,Nt,W,Math.abs(At)),t.strokeStyle="#f59e0b",t.lineWidth=1,t.strokeRect(B+ft+W,Nt,W,Math.abs(At)),t.fillStyle="rgba(255, 255, 255, 0.4)",t.font="10px JetBrains Mono, monospace",t.textAlign="center",t.fillText(`x${S+1}`,B+vt/2,ht+at-2)}const Wt=ht+at+12;t.font="10px Inter, sans-serif",t.fillStyle="#06b6d4",t.textAlign="right",t.fillText("■ True",D+O/2-5,Wt),t.fillStyle="#f59e0b",t.textAlign="left",t.fillText("■ Recovered",D+O/2+5,Wt);const rt=I+X+30;t.fillStyle="rgba(255, 255, 255, 0.5)",t.font="11px JetBrains Mono, monospace",t.textAlign="left";const _t=g[L],le=g[M],zt=e(),Tt=Math.sqrt(Mt.reduce((S,B,W)=>S+(B-h[W])**2,0)/h.reduce((S,B)=>S+B*B,0))*100;t.fillText(`λ = ${_t.lambda.toExponential(2)}`,k,rt),t.fillText(`‖xλ‖ = ${_t.solNorm.toFixed(3)}`,k,rt+16),t.fillText(`‖rλ‖ = ${_t.resNorm.toFixed(3)}`,k,rt+32),t.fillStyle=Tt<10?"#22c55e":Tt<30?"#f59e0b":"#ef4444",t.fillText(`err = ${Tt.toFixed(1)}%`,k+180,rt),t.fillStyle="#22c55e",t.fillText(`λ* = ${le.lambda.toExponential(2)}`,k+180,rt+16),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillText(`κ = ${zt[0].toFixed(1)} / ${zt[s-1].toExponential(1)}`,k+180,rt+32),requestAnimationFrame(d)};const n=document.createElement("canvas");n.style.width="100%",n.style.height="100%",pt.style.position="relative",pt.replaceChildren(n);const s=5,h=[1,.8,.5,.3,.1];let f=42;const l=200,c=-8,p=4,v=Array.from({length:l},(t,u)=>c+(p-c)*u/(l-1)),_=v.map(t=>Math.pow(10,t));let y=.5,F=4,E=-2,w=[];i(),Rt&&Rt.addEventListener("input",()=>{if(E=parseFloat(Rt.value),Yt){const t=Math.pow(10,E);Yt.textContent=t<.001?t.toExponential(1):t.toFixed(4)}}),Ct&&Ct.addEventListener("input",()=>{y=parseFloat(Ct.value),Ht&&(Ht.textContent=y.toFixed(2))}),It&&It.addEventListener("input",()=>{F=parseFloat(It.value),Jt&&(Jt.textContent=`10^${F.toFixed(1)}`)}),T(),window.addEventListener("resize",T),d()}const xt=document.getElementById("dt-slider-viz"),kt=document.getElementById("dt-slider"),Xt=document.getElementById("dt-value");if(xt&&kt){let C=function(n){return{nn_V:P.nn_selftest_V[n],nn_Phi:P.nn_selftest_Phi[n],oracle_V:P.oracle_selftest_V[n],oracle_Phi:P.oracle_selftest_Phi[n],mle_V:P.oracle_mle_V[n],mle_Phi:P.oracle_mle_Phi[n]}},o=function(){const n=xt.getBoundingClientRect(),s=window.devicePixelRatio;x.width=n.width*s,x.height=n.height*s,x.getContext("2d").setTransform(s,0,0,s,0,0)},i=function(n,s,h){return n+(s-n)*h},e=function(n){return n<=5?`rgb(${Math.round(i(34,200,n/5))}, ${Math.round(i(197,180,n/5))}, ${Math.round(i(94,20,n/5))})`:n<=30?`rgb(${Math.round(i(200,239,(n-5)/25))}, ${Math.round(i(180,100,(n-5)/25))}, ${Math.round(i(20,20,(n-5)/25))})`:`rgb(239, ${Math.round(i(100,50,Math.min((n-30)/70,1)))}, ${Math.round(i(20,50,Math.min((n-30)/70,1)))})`},a=function(){const n=x.getContext("2d"),s=x.width/window.devicePixelRatio,h=x.height/window.devicePixelRatio;n.clearRect(0,0,s,h);const f=C(T);for(const[u,b]of Object.entries(f))u in r||(r[u]=b),r[u]+=(b-r[u])*.12;const l=150,c=40,p=10,v=44,_=18,y=s-l-c,F=100,E=[{title:"∇V Error",rows:[{method:d[0],val:r.nn_V,target:f.nn_V},{method:d[1],val:r.oracle_V,target:f.oracle_V},{method:d[2],val:r.mle_V,target:f.mle_V}]},{title:"∇Φ Error",rows:[{method:d[0],val:r.nn_Phi,target:f.nn_Phi},{method:d[1],val:r.oracle_Phi,target:f.oracle_Phi},{method:d[2],val:r.mle_Phi,target:f.mle_Phi}]}];let w=p;for(const u of E){n.fillStyle="rgba(255, 255, 255, 0.5)",n.font="bold 12px Inter, sans-serif",n.textAlign="left",n.fillText(u.title,l,w+14),w+=22;for(const b of u.rows){const g=w+(v-_)/2;n.fillStyle=b.method.label,n.font="12px Inter, sans-serif",n.textAlign="right",n.fillText(b.method.name,l-12,g+_/2+4);const R=n.createLinearGradient(l,0,l+y,0);R.addColorStop(0,"rgba(34, 197, 94, 0.15)"),R.addColorStop(.1,"rgba(34, 197, 94, 0.12)"),R.addColorStop(.3,"rgba(245, 158, 11, 0.12)"),R.addColorStop(.6,"rgba(239, 68, 68, 0.12)"),R.addColorStop(1,"rgba(239, 68, 68, 0.2)"),n.fillStyle=R,n.beginPath(),n.roundRect(l,g,y,_,4),n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.06)",n.lineWidth=1,n.stroke();const M=5/F*y;n.fillStyle="rgba(34, 197, 94, 0.08)",n.beginPath(),n.roundRect(l,g,M,_,[4,0,0,4]),n.fill();const A=Math.min(b.val/F,1),L=A*y,V=e(b.val);n.fillStyle=V,n.globalAlpha=.35,n.beginPath(),n.roundRect(l,g,L,_,4),n.fill(),n.globalAlpha=1;const k=l+A*y,$=g+_/2,I=8;n.beginPath(),n.arc(k,$,I+4,0,Math.PI*2),n.fillStyle=`${b.method.dot}33`,n.fill(),n.beginPath(),n.arc(k,$,I,0,Math.PI*2),n.fillStyle=b.method.dot,n.fill(),n.beginPath(),n.arc(k,$,I,0,Math.PI*2),n.strokeStyle=b.method.ring,n.lineWidth=2,n.stroke();const q=`${b.target.toFixed(1)}%`,Y=k+I+8;n.fillStyle=b.val>30?"#ef4444":b.val>10?"#f59e0b":"#22c55e",n.font="bold 11px JetBrains Mono, monospace",n.textAlign="left",A>.85?(n.textAlign="right",n.fillText(q,k-I-6,$+4)):n.fillText(q,Y,$+4),w+=v}w+=8}const t=w+2;n.fillStyle="#22c55e",n.font="10px Inter, sans-serif",n.textAlign="left",n.fillText("Good (0%)",l,t),n.fillStyle="#ef4444",n.textAlign="right",n.fillText("Bad (100%)",l+y,t),n.fillStyle="rgba(255, 255, 255, 0.25)",n.textAlign="center",n.fillText("10%",l+y*.1,t),n.fillText("50%",l+y*.5,t),n.fillStyle="rgba(255, 255, 255, 0.35)",n.font="11px Inter, sans-serif",n.textAlign="center",n.fillText(`Model A at Δt = ${m[T]}  (d=2, M=2000, N=10)`,s/2,t+20),requestAnimationFrame(a)};const m=["0.001","0.01","0.1"],P={oracle_mle_V:[6.08,20.3,.49],oracle_mle_Phi:[12.5,52.9,92.2],oracle_selftest_V:[.78,.82,8.03],oracle_selftest_Phi:[1.72,2.69,2.84],nn_selftest_V:[.45,1.95,5.69],nn_selftest_Phi:[3.81,4.03,8.86]},x=document.createElement("canvas");x.style.width="100%",x.style.height="100%",xt.style.position="relative",xt.replaceChildren(x);let T=1,r={};const d=[{key:"nn",name:"NN Self-Test (ours)",dot:"#22c55e",ring:"#16a34a",label:"#22c55e"},{key:"oracle",name:"Oracle Self-Test",dot:"#f59e0b",ring:"#d97706",label:"#f59e0b"},{key:"mle",name:"Oracle MLE",dot:"#94a3b8",ring:"#64748b",label:"#94a3b8"}];kt.addEventListener("input",()=>{T=parseInt(kt.value),Xt&&(Xt.textContent=m[T])}),o(),window.addEventListener("resize",()=>{o()}),a()}const me={"math-selftest":String.raw`\mathcal{L}(\theta) = \frac{1}{2}\, J_{\text{diss}}\, \Delta t \;-\; \frac{\sigma^2}{2}\, J_{\text{diff}}\, \Delta t \;+\; \delta E_{\text{tot}}`,"math-sde":String.raw`dX_t^i = \left(-\nabla V(X_t^i) - \frac{1}{N}\sum_{j \neq i} \nabla\Phi(X_t^i - X_t^j)\right) dt + \sigma\, dW_t^i`,"math-ito":String.raw`\underbrace{\delta E_{\text{tot}}}_{\text{energy change}} \;=\; \underbrace{\frac{\sigma^2}{2}\, J_{\text{diff}}\, \Delta t}_{\text{diffusion (income)}} \;-\; \underbrace{J_{\text{diss}}\, \Delta t}_{\text{dissipation (spending)}} \;+\; \text{martingale}`,"math-loss":String.raw`\mathbb{E}\!\left[\mathcal{L}(V^*, \Phi^*)\right] = -\frac{1}{2}\,\mathbb{E}\!\left[J_{\text{diss}}^*\, \Delta t\right] < 0 \qquad \text{vs.} \qquad \mathcal{L}(0, 0) = 0`};for(const[C,o]of Object.entries(me)){const i=document.getElementById(C);i&&se.render(o,i,{displayMode:!0,throwOnError:!1})}const mt=document.getElementById("results-heatmap"),Gt=document.querySelectorAll("[data-table]");if(mt){let C=function(n){return n<=5?`rgba(34, 197, 94, ${.3+.7*(1-n/5)})`:n<=20?`rgba(245, 158, 11, ${.3+.4*((n-5)/15)})`:n<=50?`rgba(239, 68, 68, ${.3+.3*((n-20)/30)})`:"rgba(239, 68, 68, 0.8)"},o=function(n,s,h){const f=document.createElement(n);return s&&Object.assign(f.style,s),h&&(f.textContent=h),f},i=function(n){const s=n.data;!s||s.length===0||(mt.replaceChildren(),r==="cross_method"?x(s):T(s))},e=function(){const n=document.createElement("table");return Object.assign(n.style,{width:"100%",borderCollapse:"collapse",fontSize:"0.85rem"}),n},a=function(n,s){const h=document.createElement("tr");h.style.borderBottom="2px solid rgba(255,255,255,0.1)";for(const f of s){const l=document.createElement("th");l.textContent=f.text,l.style.padding="8px",l.style.textAlign=f.colspan?"center":"left",l.style.color=f.color||"var(--text-muted)",f.colspan&&(l.colSpan=f.colspan),h.appendChild(l)}n.appendChild(h)},m=function(n,s){const h=document.createElement("tr");h.style.borderBottom="1px solid rgba(255,255,255,0.06)";for(const f of s){const l=document.createElement("th");l.textContent=f,l.style.padding="4px 8px",l.style.fontSize="0.75rem",l.style.color="var(--text-muted)",h.appendChild(l)}n.appendChild(h)},P=function(n,s,h){const f=document.createElement("td");f.textContent=s>=100?s.toFixed(0):s.toFixed(1),f.title=`${s}%`,Object.assign(f.style,{padding:"6px 8px",textAlign:"center",background:C(s),fontWeight:h?"700":"normal"}),n.appendChild(f)},x=function(n){const s=e(),h=document.createElement("thead");a(h,[{text:"Model"},{text:"d"},{text:"Oracle Best",colspan:2,color:"#22c55e"},{text:"RBF Best",colspan:2,color:"#f59e0b"},{text:"NN Best (ours)",colspan:2,color:"#3b82f6"}]),m(h,["","","∇V","∇Φ","∇V","∇Φ","∇V","∇Φ"]),s.appendChild(h);const f=document.createElement("tbody");for(const l of n){const c=document.createElement("tr");c.style.borderBottom="1px solid rgba(255,255,255,0.04)";const p=o("td",{padding:"6px 8px",fontWeight:"600"},l.model);c.appendChild(p);const v=o("td",{padding:"6px 8px",textAlign:"center",color:"var(--text-muted)"},String(l.d));c.appendChild(v);const _=Math.min(l.oracle_V,l.rbf_V,l.nn_V),y=Math.min(l.oracle_Phi,l.rbf_Phi,l.nn_Phi);P(c,l.oracle_V,l.oracle_V===_),P(c,l.oracle_Phi,l.oracle_Phi===y),P(c,l.rbf_V,l.rbf_V===_),P(c,l.rbf_Phi,l.rbf_Phi===y),P(c,l.nn_V,l.nn_V===_),P(c,l.nn_Phi,l.nn_Phi===y),f.appendChild(c)}s.appendChild(f),mt.replaceChildren(s)},T=function(n){const s=e(),h=document.createElement("thead");a(h,[{text:"Model"},{text:"Δt"},{text:"Oracle MLE",colspan:2,color:"#22c55e"},{text:"Oracle Self-Test",colspan:2,color:"#f59e0b"},{text:"NN Self-Test",colspan:2,color:"#3b82f6"}]),m(h,["","","∇V","∇Φ","∇V","∇Φ","∇V","∇Φ"]),s.appendChild(h);const f=document.createElement("tbody");for(const l of n){const c=document.createElement("tr");c.style.borderBottom="1px solid rgba(255,255,255,0.04)";const p=o("td",{padding:"6px 8px",fontWeight:"600"},l.model);c.appendChild(p);const v=o("td",{padding:"6px 8px",textAlign:"center",fontFamily:"var(--font-mono)",fontSize:"0.8rem",color:"var(--text-muted)"},String(l.dt_obs));c.appendChild(v);const _=Math.min(l.oracle_mle_V,l.oracle_selftest_V,l.nn_selftest_V),y=Math.min(l.oracle_mle_Phi,l.oracle_selftest_Phi,l.nn_selftest_Phi);P(c,l.oracle_mle_V,l.oracle_mle_V===_),P(c,l.oracle_mle_Phi,l.oracle_mle_Phi===y),P(c,l.oracle_selftest_V,l.oracle_selftest_V===_),P(c,l.oracle_selftest_Phi,l.oracle_selftest_Phi===y),P(c,l.nn_selftest_V,l.nn_selftest_V===_),P(c,l.nn_selftest_Phi,l.nn_selftest_Phi===y),f.appendChild(c)}s.appendChild(f),mt.replaceChildren(s)},r="cross_method";Gt.forEach(n=>{n.addEventListener("click",()=>{Gt.forEach(s=>s.classList.remove("active")),n.classList.add("active"),r=n.dataset.table||"cross_method",d()})});async function d(){const n="/ips_unlabeled_learning_web";try{const h=await(await fetch(`${n}/data/${r}.json`)).json();i(h)}catch{mt.textContent="Loading results data..."}}d()}class ee{s;constructor(o){this.s=new Uint32Array(4);for(let i=0;i<4;i++){o+=2654435769;let e=o^o>>>16;e=Math.imul(e,569420461),e^=e>>>15,e=Math.imul(e,1935289751),e^=e>>>15,this.s[i]=e>>>0}}next(){const o=this.s,i=Math.imul(o[1]*5,7)>>>0,e=o[1]<<9;return o[2]^=o[0],o[3]^=o[1],o[1]^=o[2],o[0]^=o[3],o[2]^=e,o[3]=o[3]<<11|o[3]>>>21,(i>>>0)/4294967296}random(){return this.next()}randn(){const o=this.next(),i=this.next();return Math.sqrt(-2*Math.log(o+1e-30))*Math.cos(2*Math.PI*i)}randnArray(o){for(let i=0;i<o.length;i++)o[i]=this.randn()}}class Bt{constructor(o,i,e,a,m,P,x=42){this.V=o,this.Phi=i,this.sigma=e,this.dt=a,this.N=m,this.d=P,this.prng=new ee(x),this.gradV=new Float64Array(P),this.gradPhi=new Float64Array(P),this.diff=new Float64Array(P),this.noise=new Float64Array(m*P),this.gradOut=new Float64Array(P)}gradV;gradPhi;diff;noise;gradOut;prng;initialize(o=1){const i=new Float64Array(this.N*this.d);for(let e=0;e<i.length;e++)i[e]=o*this.prng.randn();return{positions:i,N:this.N,d:this.d}}getParticle(o,i){return o.positions.subarray(i*this.d,(i+1)*this.d)}step(o){const{N:i,d:e,dt:a,sigma:m}=this,P=Math.sqrt(a);this.prng.randnArray(this.noise);for(let x=0;x<i;x++){const T=this.getParticle(o,x);this.V.gradient(T,this.gradV);for(let d=0;d<e;d++)this.gradPhi[d]=0;if(this.Phi.radial)for(let d=0;d<i;d++){if(x===d)continue;const n=this.getParticle(o,d);let s=0;for(let l=0;l<e;l++)this.diff[l]=T[l]-n[l],s+=this.diff[l]*this.diff[l];const h=Math.max(Math.sqrt(s),1e-10),f=this.Phi.gradient(h);for(let l=0;l<e;l++)this.gradPhi[l]+=f*this.diff[l]/h}else for(let d=0;d<i;d++){if(x===d)continue;const n=this.getParticle(o,d);for(let s=0;s<e;s++)this.diff[s]=T[s]-n[s];this.Phi.gradient(this.diff,this.gradOut);for(let s=0;s<e;s++)this.gradPhi[s]+=this.gradOut[s]}for(let d=0;d<e;d++)this.gradPhi[d]/=i;const r=x*e;for(let d=0;d<e;d++)T[d]+=(-this.gradV[d]-this.gradPhi[d])*a+m*P*this.noise[r+d]}}simulate(o,i=1){const e=this.initialize(i),a=[{positions:new Float64Array(e.positions),N:this.N,d:this.d}];for(let m=0;m<o;m++)this.step(e),(m%10===0||m===o-1)&&a.push({positions:new Float64Array(e.positions),N:this.N,d:this.d});return a}}class ue{constructor(o=1){this.k=o}evaluate(o){let i=0;for(let e=0;e<o.length;e++)i+=o[e]*o[e];return .5*this.k*i}gradient(o,i){for(let e=0;e<o.length;e++)i[e]=this.k*o[e]}}class be{constructor(o=-1,i=2){this.alpha1=o,this.alpha2=i}evaluate(o){let i=0;for(let a=0;a<o.length;a++)i+=o[a]*o[a];const e=Math.sqrt(i);return .5*this.alpha1*e+this.alpha2*i}gradient(o,i){let e=0;for(let x=0;x<o.length;x++)e+=o[x]*o[x];const a=Math.max(Math.sqrt(e),1e-10),m=.5*this.alpha1/a,P=2*this.alpha2;for(let x=0;x<o.length;x++)i[x]=m*o[x]+P*o[x]}}class Pt{evaluate(o){let i=0;for(let e=0;e<o.length;e++)i+=o[e]*o[e];return .25*(i-1)**2}gradient(o,i){let e=0;for(let m=0;m<o.length;m++)e+=o[m]*o[m];const a=e-1;for(let m=0;m<o.length;m++)i[m]=a*o[m]}}class pe{constructor(o){this.a=o}evaluate(o){let i=0;for(let e=0;e<o.length;e++)i+=this.a[e]*o[e]*o[e];return i}gradient(o,i){for(let e=0;e<o.length;e++)i[e]=2*this.a[e]*o[e]}}class xe{constructor(o=-3,i=2,e=.05){this.beta1=o,this.beta2=i,this.eps=e}radial=!0;smoothInd(o,i,e){return .5*(Math.tanh((o-i)/this.eps)-Math.tanh((o-e)/this.eps))}smoothIndGrad(o,i,e){const a=1/Math.cosh((o-i)/this.eps)**2,m=1/Math.cosh((o-e)/this.eps)**2;return .5/this.eps*(a-m)}evaluate(o){return this.beta1*this.smoothInd(o,.5,1)+this.beta2*this.smoothInd(o,1,2)}gradient(o){return this.beta1*this.smoothIndGrad(o,.5,1)+this.beta2*this.smoothIndGrad(o,1,2)}}class qt{constructor(o=.5){this.gamma=o}radial=!0;evaluate(o){return this.gamma/(o+1)}gradient(o){return-this.gamma/((o+1)*(o+1))}}class ye{constructor(o=.5,i=2,e=.8){this.D=o,this.a=i,this.r0=e}radial=!0;evaluate(o){const i=Math.exp(-this.a*(o-this.r0));return this.D*(1-i)**2}gradient(o){const i=Math.exp(-this.a*(o-this.r0));return 2*this.D*this.a*(1-i)*i}}class we{constructor(o=.5,i=.5,e=2.5,a=.7){this.epsilon=o,this.sigmaLJ=i,this.rCut=e,this.rSafe=a*i;const m=(i/e)**6;this.shift=4*o*(m**2-m)}radial=!0;rSafe;shift;evaluate(o){if(o>=this.rCut)return 0;const i=Math.max(o,this.rSafe),e=(this.sigmaLJ/i)**6;return 4*this.epsilon*(e*e-e)-this.shift}gradient(o){if(o>=this.rCut)return 0;const i=Math.max(o,this.rSafe),e=(this.sigmaLJ/i)**6;return 4*this.epsilon/i*(-12*e*e+6*e)}}class Pe{constructor(o=2,i=[.5,1.5]){this.A=o,this.s=i,this.sSq=i.map(e=>e*e)}radial=!1;sSq;evaluate(o){let i=0;for(let e=0;e<o.length;e++)i+=o[e]*o[e]/this.sSq[e];return this.A*Math.exp(-.5*i)}gradient(o,i){const e=this.evaluate(o);for(let a=0;a<o.length;a++)i[a]=-e*o[a]/this.sSq[a]}}const Lt={model_a:{name:"model_a",label:"Model A (Quadratic + Piecewise)",V:new be(-1,2),Phi:new xe(-3,2),sigma:.1,description:"Quadratic confinement with piecewise constant interaction"},model_b:{name:"model_b",label:"Model B (Double-Well + Inverse)",V:new Pt,Phi:new qt(.5),sigma:.1,description:"Double-well confinement with inverse-distance interaction"},model_lj:{name:"model_lj",label:"Model C (Harmonic + Lennard-Jones)",V:new ue(2),Phi:new we,sigma:.1,description:"Harmonic confinement with truncated Lennard-Jones interaction"},model_morse:{name:"model_morse",label:"Model D (Double-Well + Morse)",V:new Pt,Phi:new ye(.5,2,.8),sigma:.1,description:"Double-well confinement with Morse interaction"},model_aniso:{name:"model_aniso",label:"Model E (Anisotropic)",V:new pe([1,4]),Phi:new Pe(2,[.5,1.5]),sigma:.1,description:"Anisotropic confinement with direction-dependent Gaussian interaction"}},yt=document.getElementById("potential-curves-canvas"),wt=document.getElementById("model-sim-canvas"),Ut=document.querySelectorAll(".model-tabs .toggle-btn");if(yt&&wt){let C=function(r){const d=Lt[r];d&&(P=r,x=new Bt(d.V,d.Phi,d.sigma,.005,10,2,42),T=x.initialize(.8))},o=function(){const r=Lt[P];if(!r)return;const d=yt.width,n=yt.height;a.clearRect(0,0,d,n);const s=45,h=15,f=25,l=35,c=d-s-h,p=(n-f-l-20)/2;i(a,s,f,c,p,"V(x)","#3b82f6",_=>{const y=new Float64Array([_,0]);return r.V.evaluate(y)},-2.5,2.5,-1,5);const v=f+p+20;r.Phi.radial?i(a,s,v,c,p,"Φ(r)","#8b5cf6",_=>r.Phi.evaluate(Math.abs(_)),0,3,-4,3):i(a,s,v,c,p,"Φ(z₁,0)","#8b5cf6",_=>{const y=new Float64Array([_,0]);return r.Phi.evaluate(y)},-3,3,-.5,2.5)},i=function(r,d,n,s,h,f,l,c,p,v,_,y){if(r.fillStyle="rgba(0, 0, 0, 0.2)",r.fillRect(d,n,s,h),r.strokeStyle="rgba(255, 255, 255, 0.15)",r.lineWidth=1,r.beginPath(),r.moveTo(d,n+h),r.lineTo(d+s,n+h),r.stroke(),_<0&&y>0){const E=n+h- -_/(y-_)*h;r.strokeStyle="rgba(255, 255, 255, 0.08)",r.setLineDash([3,3]),r.beginPath(),r.moveTo(d,E),r.lineTo(d+s,E),r.stroke(),r.setLineDash([])}r.beginPath(),r.strokeStyle=l,r.lineWidth=2;const F=200;for(let E=0;E<=F;E++){const w=E/F,t=p+w*(v-p);let u=c(t);u=Math.max(_,Math.min(y,u));const b=d+w*s,g=n+h-(u-_)/(y-_)*h;E===0?r.moveTo(b,g):r.lineTo(b,g)}r.stroke(),r.fillStyle=l,r.font="bold 11px Inter, sans-serif",r.textAlign="left",r.fillText(f,d+5,n+15),r.fillStyle="rgba(255, 255, 255, 0.3)",r.font="9px var(--font-mono), monospace",r.textAlign="left",r.fillText(`${p}`,d,n+h+12),r.textAlign="right",r.fillText(`${v}`,d+s,n+h+12)},e=function(){if(!x||!T)return;const r=wt.width,d=wt.height;m.clearRect(0,0,r,d);for(let c=0;c<3;c++)x.step(T);const n=T.positions,s=Math.min(r,d)*.12,h=r/2,f=d/2;for(let c=0;c<10;c++)for(let p=c+1;p<10;p++){const v=n[c*2]-n[p*2],_=n[c*2+1]-n[p*2+1],y=Math.sqrt(v*v+_*_);if(y<2){const F=h+n[c*2]*s,E=f-n[c*2+1]*s,w=h+n[p*2]*s,t=f-n[p*2+1]*s;m.beginPath(),m.moveTo(F,E),m.lineTo(w,t),m.strokeStyle=`rgba(139, 92, 246, ${.2*(1-y/2)})`,m.lineWidth=1,m.stroke()}}for(let c=0;c<10;c++){const p=h+n[c*2]*s,v=f-n[c*2+1]*s;m.beginPath(),m.arc(p,v,7,0,Math.PI*2),m.fillStyle="#06b6d4",m.globalAlpha=.8,m.fill(),m.globalAlpha=1}const l=Lt[P];m.fillStyle="rgba(255, 255, 255, 0.4)",m.font="11px Inter, sans-serif",m.textAlign="left",m.fillText(l?.description||"",10,d-10),requestAnimationFrame(e)};const a=yt.getContext("2d"),m=wt.getContext("2d");let P="model_a",x,T;Ut.forEach(r=>{r.addEventListener("click",()=>{Ut.forEach(n=>n.classList.remove("active")),r.classList.add("active");const d=r.dataset.model||"model_a";C(d),o()})}),C("model_a"),o(),e()}const nt=document.getElementById("loss-landscape-canvas");if(nt){let C=function(){const e=nt.parentElement.getBoundingClientRect();nt.width=e.width*window.devicePixelRatio,nt.height=e.height*window.devicePixelRatio,i.scale(window.devicePixelRatio,window.devicePixelRatio),o()},o=function(){const e=nt.width/window.devicePixelRatio,a=nt.height/window.devicePixelRatio;i.clearRect(0,0,e,a);const m=60,P=30,x=40,T=50,r=(e-m-P-40)/2,d=a-x-T,n=[{x:m,label:"|Residual|² (degenerate)",color:"#ef4444",fn:"squared"},{x:m+r+40,label:"Self-Test Loss (ours)",color:"#3b82f6",fn:"selftest"}],s=2,h=1;for(const f of n){const{x:l,label:c,color:p,fn:v}=f;i.strokeStyle="rgba(255, 255, 255, 0.15)",i.lineWidth=1,i.beginPath(),i.moveTo(l,x),i.lineTo(l,x+d),i.lineTo(l+r,x+d),i.stroke();const _=x+d*.4;i.strokeStyle="rgba(255, 255, 255, 0.08)",i.setLineDash([4,4]),i.beginPath(),i.moveTo(l,_),i.lineTo(l+r,_),i.stroke(),i.setLineDash([]),i.fillStyle="rgba(255, 255, 255, 0.4)",i.font="10px Inter, sans-serif",i.textAlign="right",i.fillText("0",l-5,_+4),i.textAlign="center",i.fillText(c,l+r/2,x-10),i.fillText("0",l,x+d+18),i.fillText("scale s",l+r/2,x+d+35),i.fillText("1 (true)",l+r*.5,x+d+18),i.fillText("2",l+r,x+d+18),i.beginPath(),i.strokeStyle=p,i.lineWidth=2.5;const y=200;for(let E=0;E<=y;E++){const w=E/y*2,t=l+E/y*r;let u;if(v==="squared"){const M=.5*w*w*s-w*h*.5;u=M*M}else u=.5*w*w*s-w*s;const b=v==="squared"?.5:1.5,g=_-u*(d*.3)*b,R=Math.max(x,Math.min(x+d,g));E===0?i.moveTo(t,R):i.lineTo(t,R)}i.stroke();const F=(E,w,t)=>{const u=l+E/2*r;let b;if(v==="squared"){const M=.5*E*E*s-E*h*.5;b=M*M}else b=.5*E*E*s-E*s;const g=v==="squared"?.5:1.5,R=Math.max(x,Math.min(x+d,_-b*(d*.3)*g));i.beginPath(),i.arc(u,R,5,0,Math.PI*2),i.fillStyle=t,i.fill(),i.fillStyle=t,i.font="bold 10px Inter, sans-serif",i.textAlign="center",i.fillText(w,u,R-12)};F(0,"s=0","#f59e0b"),F(1,"s=1 (true)","#22c55e"),v==="squared"?(i.fillStyle="#ef4444",i.font="11px Inter, sans-serif",i.textAlign="center",i.fillText("Both are minima!",l+r/2,x+d-10)):(i.fillStyle="#22c55e",i.font="11px Inter, sans-serif",i.textAlign="center",i.fillText("Only true minimum is negative",l+r/2,x+d-10))}};const i=nt.getContext("2d");C(),window.addEventListener("resize",C)}const ot=document.getElementById("energy-canvas"),Qt=document.getElementById("v-scale"),Kt=document.getElementById("phi-scale");if(ot&&Qt&&Kt){let C=function(y,F,E){let w=0,t=0;const u=new Float64Array(P);for(let b=0;b<m;b++){for(let g=0;g<P;g++)u[g]=y[b*P+g];w+=r.evaluate(u)*F;for(let g=b+1;g<m;g++){let R=0;for(let M=0;M<P;M++){const A=y[b*P+M]-y[g*P+M];R+=A*A}t+=d.evaluate(Math.sqrt(R))*E}}return w/m+t/(m*m)},o=function(y,F,E){let w=0;const t=new Float64Array(P),u=new Float64Array(P),b=new Float64Array(P);for(let g=0;g<m;g++){for(let V=0;V<P;V++)b[V]=y[g*P+V];r.gradient(b,t);for(let V=0;V<P;V++)t[V]*=F;let R=0,M=0;for(let V=0;V<m;V++){if(g===V)continue;let k=0;for(let q=0;q<P;q++)u[q]=y[g*P+q]-y[V*P+q],k+=u[q]*u[q];const $=Math.max(Math.sqrt(k),1e-10),I=d.gradient($)*E;R+=I*u[0]/$,M+=I*u[1]/$}R/=m,M/=m;const A=t[0]+R,L=t[1]+M;w+=A*A+L*L}return w/m},i=function(){const y=ot.parentElement.getBoundingClientRect();ot.width=y.width*window.devicePixelRatio,ot.height=y.height*window.devicePixelRatio,a.scale(window.devicePixelRatio,window.devicePixelRatio)},e=function(){const y=ot.width/window.devicePixelRatio,F=ot.height/window.devicePixelRatio;a.clearRect(0,0,y,F);const E=parseFloat(Qt.value),w=parseFloat(Kt.value);for(let z=0;z<3;z++)n.step(s);const t=C(_,E,w),b=C(s.positions,E,w)-t,g=o(_,E,w)*T;h=c*h+(1-c)*(.5*g),f=c*f+(1-c)*b;const R=h+f;l=c*l+(1-c)*R,v.push(l),v.length>p&&v.shift(),_.set(s.positions);const M=y*.4,A=M+30,L=Math.min(M,F)/5.5,V=M/2,k=F/2;a.beginPath(),a.arc(V,k,L,0,Math.PI*2),a.strokeStyle="rgba(255, 255, 255, 0.04)",a.lineWidth=1,a.stroke();for(let z=0;z<m;z++){const U=V+s.positions[z*2]*L,J=k-s.positions[z*2+1]*L;a.beginPath(),a.arc(U,J,14,0,Math.PI*2),a.fillStyle="rgba(59, 130, 246, 0.08)",a.fill(),a.beginPath(),a.arc(U,J,8,0,Math.PI*2),a.fillStyle="#3b82f6",a.globalAlpha=.7,a.fill(),a.globalAlpha=1}const $=y-A-20,I=22,q=30;a.fillStyle="rgba(255, 255, 255, 0.6)",a.font="bold 13px Inter, sans-serif",a.textAlign="left",a.fillText("Energy Ledger",A,q);const Y=$*.7,j=Math.min(Math.abs(h)*2e3,Y),N=q+25;a.fillStyle="rgba(239, 68, 68, 0.15)",a.fillRect(A,N,$,I),a.fillStyle="rgba(239, 68, 68, 0.6)",a.fillRect(A,N,j,I),a.fillStyle="#ef4444",a.font="11px Inter, sans-serif",a.fillText(`Dissipation (spending): ${h.toFixed(5)}`,A+5,N+15);const H=N+I+8,X=Math.min(Math.abs(f)*2e3,Y);a.fillStyle="rgba(59, 130, 246, 0.15)",a.fillRect(A,H,$,I),a.fillStyle=f<0?"rgba(34, 197, 94, 0.6)":"rgba(59, 130, 246, 0.6)",a.fillRect(A,H,X,I),a.fillStyle="#3b82f6",a.fillText(`Energy change (balance): ${f.toFixed(5)}`,A+5,H+15);const K=H+I+15,dt=Math.abs(l)<.001?"#22c55e":"#ef4444";a.fillStyle=dt,a.font="bold 13px Inter, sans-serif",a.fillText(`Self-test loss: ${l.toFixed(5)}`,A,K+5),a.fillStyle="rgba(255, 255, 255, 0.4)",a.font="11px Inter, sans-serif",a.fillText(`V scale: ${E.toFixed(1)}×  |  Φ scale: ${w.toFixed(1)}×`,A,K+25);const lt=Math.abs(E-1)<.05&&Math.abs(w-1)<.05;a.fillStyle=lt?"#22c55e":"#f59e0b",a.fillText(lt?"✓ True potentials — loss is negative":"✗ Wrong potentials — residual grows",A,K+45);const Z=K+65,G=F-Z-20;if(G>40&&v.length>2){a.strokeStyle="rgba(255, 255, 255, 0.1)",a.lineWidth=1,a.beginPath(),a.moveTo(A,Z+G/2),a.lineTo(A+$,Z+G/2),a.stroke();const z=Math.min(...v,-.01),J=Math.max(...v,.01)-z||.01;a.beginPath(),a.strokeStyle=dt,a.lineWidth=1.5;for(let tt=0;tt<v.length;tt++){const D=A+tt/p*$,O=Z+G-(v[tt]-z)/J*G;tt===0?a.moveTo(D,O):a.lineTo(D,O)}a.stroke()}requestAnimationFrame(e)};const a=ot.getContext("2d"),m=10,P=2,x=.15,T=.008,r=new Pt,d=new qt(.5),n=new Bt(r,d,x,T,m,P,77),s=n.initialize(1);for(let y=0;y<300;y++)n.step(s);let h=0,f=0,l=0;const c=.95,p=200,v=[];let _=new Float64Array(s.positions);i(),window.addEventListener("resize",i),e()}const it=document.getElementById("shuffle-demo-canvas"),Zt=document.getElementById("shuffle-btn");if(it&&Zt){let C=function(){const s=it.parentElement.getBoundingClientRect();it.width=s.width*window.devicePixelRatio,it.height=s.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio)},o=function(s,h,f,l,c){return[f+s*c,l-h*c]},i=function(){const s=it.width/window.devicePixelRatio,h=it.height/window.devicePixelRatio,f=s/2,l=Math.min(f,h)*.35;e.clearRect(0,0,s,h),n<1&&(n=Math.min(1,n+.03)),e.fillStyle="rgba(255, 255, 255, 0.03)",e.fillRect(0,0,f-1,h),e.fillStyle="rgba(255, 255, 255, 0.5)",e.font="13px Inter, sans-serif",e.textAlign="center",e.fillText("Snapshot t₁",f/2,25),e.fillStyle="rgba(255, 255, 255, 0.03)",e.fillRect(f+1,0,f,h),e.fillStyle="rgba(255, 255, 255, 0.5)",e.fillText("Snapshot t₂",f+f/2,25);for(let p=0;p<a;p++){const[v,_]=o(x[p][0],x[p][1],f/2,h/2,l),y=r[p],[F,E]=o(T[y][0],T[y][1],f+f/2,h/2,l),w=p,[t,u]=o(T[w][0],T[w][1],f+f/2,h/2,l),b=t+(F-t)*n,g=u+(E-u)*n,R=y===p;e.beginPath(),e.moveTo(v,_),e.lineTo(b,g),e.strokeStyle=R||!d?"rgba(34, 197, 94, 0.4)":"rgba(239, 68, 68, 0.4)",e.lineWidth=1.5,e.setLineDash([4,4]),e.stroke(),e.setLineDash([])}const c=14;for(let p=0;p<a;p++){const[v,_]=o(x[p][0],x[p][1],f/2,h/2,l);e.beginPath(),e.arc(v,_,c,0,Math.PI*2),e.fillStyle=P[p],e.fill(),e.fillStyle="white",e.font="bold 10px Inter, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(`${p+1}`,v,_),r[p];const[y,F]=o(T[p][0],T[p][1],f+f/2,h/2,l);e.beginPath(),e.arc(y,F,c,0,Math.PI*2),e.fillStyle=d?"#475569":P[p],e.fill(),d?(e.fillStyle="rgba(255,255,255,0.5)",e.fillText("?",y,F)):(e.fillStyle="white",e.fillText(`${p+1}`,y,F))}if(d&&n>=1){const p=r.filter((v,_)=>v===_).length;e.fillStyle="rgba(255, 255, 255, 0.6)",e.font="12px Inter, sans-serif",e.textAlign="center",e.fillText(`Random matching: ${p}/${a} correct`,s/2,h-15)}requestAnimationFrame(i)};const e=it.getContext("2d"),a=8,m=new ee(123),P=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#f97316"],x=[],T=[];for(let s=0;s<a;s++){const h=-.8+m.random()*1.6,f=-.7+m.random()*1.4;x.push([h,f]),T.push([h+(m.random()-.5)*.6,f+(m.random()-.5)*.6])}let r=Array.from({length:a},(s,h)=>h),d=!1,n=1;Zt.addEventListener("click",()=>{if(!(n<1)){if(d)r=Array.from({length:a},(s,h)=>h),d=!1;else{r=Array.from({length:a},(s,h)=>h);for(let s=a-1;s>0;s--){const h=Math.floor(Math.random()*(s+1));[r[s],r[h]]=[r[h],r[s]]}d=!0}n=0}}),C(),window.addEventListener("resize",C),i()}const Q=document.getElementById("label-demo-canvas");if(Q){let C=function(){const c=Q.parentElement.getBoundingClientRect();Q.width=c.width*window.devicePixelRatio,Q.height=c.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio)},o=function(c,p,v,_){const y=Math.min(v,_)/5.5;return[v/2+c*y,_/2-p*y]},i=function(){const c=Q.width/window.devicePixelRatio,p=Q.height/window.devicePixelRatio;e.clearRect(0,0,c,p);for(let w=0;w<5;w++)T.step(r);n.push(new Float64Array(r.positions)),n.length>d&&n.shift();const v=r.positions,[_,y]=o(0,0,c,p),F=Math.min(c,p)/5.5;if(e.beginPath(),e.arc(_,y,F,0,Math.PI*2),e.strokeStyle="rgba(255, 255, 255, 0.04)",e.lineWidth=1,e.stroke(),n.length>2)for(let w=0;w<a;w++){e.beginPath();for(let t=0;t<n.length;t++){const[u,b]=o(n[t][w*2],n[t][w*2+1],c,p);t===0?e.moveTo(u,b):e.lineTo(u,b)}e.strokeStyle=f?s[w]+"55":h+"40",e.lineWidth=f?2.5:2,e.stroke()}if(f)for(let w=0;w<a;w++)for(let t=w+1;t<a;t++){const u=v[w*2]-v[t*2],b=v[w*2+1]-v[t*2+1],g=Math.sqrt(u*u+b*b);if(g<1.2){const[R,M]=o(v[w*2],v[w*2+1],c,p),[A,L]=o(v[t*2],v[t*2+1],c,p);e.beginPath(),e.moveTo(R,M),e.lineTo(A,L),e.strokeStyle=`rgba(255, 255, 255, ${.12*(1-g/1.2)})`,e.lineWidth=1,e.stroke()}}const E=f?13:10;for(let w=0;w<a;w++){const[t,u]=o(v[w*2],v[w*2+1],c,p),b=f?s[w]:h;e.beginPath(),e.arc(t,u,E+6,0,Math.PI*2),e.fillStyle=f?`${b}22`:"rgba(59, 130, 246, 0.08)",e.fill(),e.beginPath(),e.arc(t,u,E,0,Math.PI*2),e.fillStyle=b,e.globalAlpha=f?1:.6,e.fill(),e.globalAlpha=1,f&&(e.fillStyle="white",e.font="bold 11px Inter, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText(`${w+1}`,t,u))}if(!f){let w=0;for(let t=0;t<a;t++)for(let u=t+1;u<a;u++){const[b,g]=o(v[t*2],v[t*2+1],c,p),[R,M]=o(v[u*2],v[u*2+1],c,p);Math.sqrt((b-R)**2+(g-M)**2)<E*3&&w++}w>0&&(e.fillStyle="rgba(239, 68, 68, 0.6)",e.font="11px Inter, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText(`${w} close pair${w>1?"s":""} — which is which?`,c/2,p-22))}requestAnimationFrame(i)};const e=Q.getContext("2d"),a=15,m=2,P=new Pt,x=new qt(.5),T=new Bt(P,x,.15,.02,a,m,42),r=T.initialize(1);for(let c=0;c<500;c++)T.step(r);const d=60,n=[],s=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#f97316","#14b8a6","#a855f7","#e11d48","#84cc16","#0ea5e9","#d946ef","#fb923c"],h="#3b82f6";let f=!0;const l=Q.closest(".demo-container")?.querySelectorAll(".toggle-btn");l?.forEach(c=>{c.addEventListener("click",()=>{l.forEach(p=>p.classList.remove("active")),c.classList.add("active"),f=c.dataset.mode==="labeled"})}),C(),window.addEventListener("resize",C),i()}const te=document.getElementById("hero-canvas");if(te){let C=function(){const t=P.attributes.position.array;for(let M=0;M<m;M++){const A=M*3,L=M*3+1,V=M*3+2;T[A]-=E*t[A],T[L]-=E*t[L],T[V]-=E*t[V];for(let k=0;k<5;k++){const $=Math.floor(Math.random()*m);if($===M)continue;const I=t[A]-t[$*3],q=t[L]-t[$*3+1],Y=t[V]-t[$*3+2],j=Math.sqrt(I*I+q*q+Y*Y)+.1,N=w*Math.exp(-j*j/4)*2*j/4;T[A]+=N*I/j,T[L]+=N*q/j,T[V]+=N*Y/j}T[A]+=(Math.random()-.5)*.005,T[L]+=(Math.random()-.5)*.005,T[V]+=(Math.random()-.5)*.005,T[A]*=.98,T[L]*=.98,T[V]*=.98,t[A]+=T[A],t[L]+=T[L],t[V]+=T[V]}P.attributes.position.needsUpdate=!0;let u=0;const b=c.attributes.position.array,g=c.attributes.color.array,R=3;for(let M=0;M<m&&u<p;M++)for(let A=M+1;A<m&&u<p;A++){const L=t[M*3]-t[A*3],V=t[M*3+1]-t[A*3+1],k=t[M*3+2]-t[A*3+2],$=Math.sqrt(L*L+V*V+k*k);if($<R){const I=1-$/R,q=u*6;b[q]=t[M*3],b[q+1]=t[M*3+1],b[q+2]=t[M*3+2],b[q+3]=t[A*3],b[q+4]=t[A*3+1],b[q+5]=t[A*3+2],g[q]=.024*I,g[q+1]=.714*I,g[q+2]=.831*I,g[q+3]=.024*I,g[q+4]=.714*I,g[q+5]=.831*I,u++}}c.setDrawRange(0,u*2),c.attributes.position.needsUpdate=!0,c.attributes.color.needsUpdate=!0,l.rotation.y+=.001,F.rotation.y+=.001,e.render(o,i),requestAnimationFrame(C)};const o=new ae,i=new re(60,window.innerWidth/window.innerHeight,.1,100);i.position.z=15;const e=new ce({canvas:te,alpha:!0,antialias:!0});e.setSize(window.innerWidth,window.innerHeight),e.setPixelRatio(Math.min(window.devicePixelRatio,2)),e.setClearColor(658967,1);const m=window.innerWidth<768?100:250,P=new jt,x=new Float32Array(m*3),T=new Float32Array(m*3),r=new Float32Array(m*3),d=new Float32Array(m),n=new Et(440020),s=new Et(3900150),h=new Et(9133302);for(let t=0;t<m;t++){const u=Math.random()*Math.PI*2,b=Math.acos(2*Math.random()-1),g=4+Math.random()*4;x[t*3]=g*Math.sin(b)*Math.cos(u),x[t*3+1]=g*Math.sin(b)*Math.sin(u),x[t*3+2]=g*Math.cos(b),T[t*3]=(Math.random()-.5)*.02,T[t*3+1]=(Math.random()-.5)*.02,T[t*3+2]=(Math.random()-.5)*.02;const R=Math.random(),M=R<.5?n.clone().lerp(s,R*2):s.clone().lerp(h,(R-.5)*2);r[t*3]=M.r,r[t*3+1]=M.g,r[t*3+2]=M.b,d[t]=.08+Math.random()*.12}P.setAttribute("position",new gt(x,3)),P.setAttribute("color",new gt(r,3)),P.setAttribute("size",new gt(d,1));const f=new de({vertexShader:`
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_PointSize = size * (200.0 / -mvPosition.z);
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      varying vec3 vColor;
      void main() {
        float d = length(gl_PointCoord - 0.5);
        if (d > 0.5) discard;
        float alpha = smoothstep(0.5, 0.1, d) * 0.7;
        gl_FragColor = vec4(vColor, alpha);
      }
    `,vertexColors:!0,transparent:!0,depthWrite:!1,blending:Ot}),l=new he(P,f);o.add(l);const c=new jt,p=m*3,v=new Float32Array(p*6),_=new Float32Array(p*6);c.setAttribute("position",new gt(v,3)),c.setAttribute("color",new gt(_,3));const y=new fe({vertexColors:!0,transparent:!0,opacity:.15,blending:Ot}),F=new ge(c,y);o.add(F);const E=.015,w=.001;C(),window.addEventListener("resize",()=>{i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)})}const Vt=document.getElementById("lang-toggle");let ct=localStorage.getItem("ips-lang")||"en";function ne(){Vt&&(Vt.textContent=ct.toUpperCase()),document.documentElement.lang=ct,document.querySelectorAll("[data-i18n-en]").forEach(C=>{const o=ct==="en"?C.getAttribute("data-i18n-en"):C.getAttribute("data-i18n-zh");o&&(C.textContent=o)})}Vt?.addEventListener("click",()=>{ct=ct==="en"?"zh":"en",localStorage.setItem("ips-lang",ct),ne()});ne();const Se=new IntersectionObserver(C=>{C.forEach(o=>{o.isIntersecting&&document.querySelectorAll(".nav-link").forEach(i=>{i.classList.toggle("active",i.getAttribute("href")===`#${o.target.id}`)})})},{rootMargin:"-20% 0px -70% 0px"});document.querySelectorAll("section[id]").forEach(C=>Se.observe(C));document.getElementById("copy-bibtex")?.addEventListener("click",C=>{const o=C.currentTarget,i=o.dataset.bibtex||"";navigator.clipboard.writeText(i).then(()=>{o.textContent="Copied!",setTimeout(()=>{o.textContent="Copy BibTeX"},2e3)})});
